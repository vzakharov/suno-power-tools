window.templates = {"colony":"<head>\n  <style>\n    body { \n      margin: 0;\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n    }\n\n    #sidebar {\n      position: fixed;\n      padding: 10px;\n      top: 0;\n      left: 0;\n      bottom: 0;\n      width: 200px;\n      background-color: #333;\n      color: #eee;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-between;\n    }\n\n    .f-row {\n      display: flex;\n      flex-direction: row;\n    }\n\n    .f-col {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .smol {\n      font-size: 0.8em;\n      color: #aaa;\n    }\n\n    .relative {\n      position: relative;\n    }\n\n    .absolute {\n      position: absolute;\n    }\n\n    .topleft {\n      top: 0;\n      left: 0;\n    }\n\n    .p-1 {\n      padding: 1rem;\n    };\n\n    .p-2 {\n      padding: 2rem;\n    }\n\n    .w-100 {\n      width: 100%;\n    }\n    \n    .h-100 {\n      height: 100%;\n    }\n\n    .j-between {\n      justify-content: space-between;\n    }\n\n    .settings > div {\n      margin-top: 5px;\n    }\n\n  </style>\n  <script src=\"https://unpkg.com/___graph_url_slug___\"></script>\n</head>\n\n<body>\n  <div id=\"graph\">\n  </div>\n  <div id=\"sidebar\">\n    <div class=\"settings f-col\">\n      <h3>Settings</h3>\n      <!-- Use next links -->\n      <div>\n        <input type=\"checkbox\" id=\"useNextLinks\" data-type=\"linkToggle\" data-kind=\"next\" checked>\n        <label for=\"useNextLinks\">Attract based on time</label>\n      </div>\n      <!-- Show next links -->\n      <div id=\"showNextLinksContainer\">\n        <input type=\"checkbox\" id=\"showNextLinks\" data-type=\"linkToggle\" data-kind=\"descendant\">\n        <label for=\"showNextLinks\">Show time-based links</label>\n      </div>\n      <!-- Use descendant links -->\n      <div>\n        <input type=\"checkbox\" id=\"useDescendantLinks\" data-type=\"linkToggle\" data-kind=\"descendant\" checked>\n        <label for=\"useDescendantLinks\">Attract to root clip</label>\n      </div>\n      <!-- Filter -->\n      <div>\n        <input type=\"text\" id=\"filter\" placeholder=\"Filter by name, style or ID\">\n        <p class=\"smol\">\n          Enter to apply. (Filter will include both matching nodes and any nodes belonging to the same root clip.)\n        </p>\n      </div>\n    </div>\n    <div id=\"audioContainer\" class=\"w-100\" style=\"display: none;\">\n      <div class=\"relative\">\n        <a id=\"audioLink\" target=\"_blank\">\n          <img id=\"audioImage\" style=\"opacity: 0.5\" class=\"w-100\">\n        </a>\n        <div class=\"absolute topleft\" style=\"width: 190px; padding: 5px;\">\n          <div id=\"audioName\"></div>\n          <div class=\"smol\" id=\"audioTags\"></div>\n        </div>\n      </div>\n      <audio controls id=\"audio\" class=\"w-100\"></audio>\n    </div>\n  </div>    \n  <div id=\"data\" style=\"display: none;\">\n    ___data___\n  </div>\n  <script>\n\n    const use3DGraph = ___use3DGraph___;\n    const data = JSON.parse(document.getElementById('data').innerText);\n    let graph = renderGraph(data);\n    Object.assign(window, { data, graph });\n\n    function visibilityChecker(link) {\n      return !{\n        descendant: true,\n        next: !document.getElementById('showNextLinks').checked\n      }[link.kind];\n    };\n\n    function renderGraph(data) {\n      const graph = new ___GraphRenderer___()\n        (document.getElementById('graph'))\n        .graphData(data)\n        .backgroundColor('#001')\n        .linkAutoColorBy('kind')\n        .nodeAutoColorBy('rootId')\n        .linkLabel('kind')\n        .linkVisibility(visibilityChecker)\n        .linkDirectionalParticles(1)\n        .nodeLabel(({ id, name, tags, image_url }) => `\n          <div class=\"relative\" style=\"width: 200px;\">\n            <img src=\"${image_url}\" style=\"opacity: 0.5; width: 200px\">\n            <div class=\"absolute topleft\" style=\"width: 190px; padding: 5px;\">\n              <div>${name || '[Untitled]'}</div>\n              <div class=\"smol\">${tags || '(no style)'}</div>\n            </div>\n          </div>\n          <div class=\"smol\">\n            Click to play, right-click to open in Suno\n          </div>\n        `)\n        .onNodeClick(({ id, name, tags, image_url, audio_url }) => {\n          document.getElementById('audioContainer').style.display = 'block';\n          document.getElementById('audioLink').href = `https://suno.com/song/${id}`;\n          document.getElementById('audioImage').src = image_url;\n          document.getElementById('audioName').innerText = name || '[Untitled]';\n          document.getElementById('audioTags').innerText = tags || '(no style)';\n          const audio = document.getElementById('audio');\n          audio.src = audio_url;\n          audio.play();\n        })\n        .onNodeRightClick(({ id }) => {\n          window.open(`https://suno.com/song/${id}`);\n        });\n      if ( use3DGraph ) {\n        graph.linkOpacity(l => l.isMain ? 1 : 0.2)\n      } else {\n        graph.linkLineDash(l => l.isMain ? undefined : [1, 2])\n      }\n      return graph;\n    };\n\n    document.querySelectorAll('[data-type=\"linkToggle\"]').forEach(checkbox => {\n      checkbox.addEventListener('change', () => {\n        const kind = checkbox.getAttribute('data-kind');\n        applyLinkFilter(checkbox);\n        if ( kind === 'next' ) {\n          document.getElementById('showNextLinksContainer').style.display = useLinks ? 'block' : 'none';\n        };\n      });\n    });\n\n    function applyLinkFilter(checkbox) {\n      const kind = checkbox.getAttribute('data-kind');\n      const useLinks = checkbox.checked;\n      let { nodes, links } = graph.graphData();\n      if ( !useLinks ) {\n        links = links.filter(l => l.kind !== kind);\n      } else {\n        links.push(...data.links.filter(l => l.kind === kind));\n      }\n      graph.graphData({ nodes, links });\n    };\n\n    document.getElementById('showNextLinks').addEventListener('change', () => {\n      graph.linkVisibility(visibilityChecker);\n    });\n    \n    // Filter (on Enter key)\n    document.getElementById('filter').addEventListener('keyup', e => {\n      if (e.keyCode === 13) {\n        const filter = e.target.value.toLowerCase();\n        const matchingNodes = filter \n          ? data.nodes.filter(node => `${node.id} ${node.name} ${node.tags} ${node.created_at}`.toLowerCase().includes(filter))\n          : data.nodes;\n        // const sameRootNodes = data.nodes.filter(node => matchingNodes.some(n => n.id !== node.id && n.rootId === node.rootId));\n        // const relevantNodes = [...matchingNodes, ...sameRootNodes];\n        const existing = graph.graphData();\n        const nodes = [\n          ...matchingNodes.map(node => existing.nodes.find(n => n.id === node.id) ?? node),\n          ...filter \n            ? data.nodes.filter(node => matchingNodes.some(n => n.rootId === node.rootId && n.id !== node.id))\n            : []\n        ].map(node => existing.nodes.find(n => n.id === node.id) ?? node);\n        const links = data.links\n          .filter(link => nodes.some(n => n.id === link.source.id) && nodes.some(n => n.id === link.target.id))\n          .map(({ source: { id: source }, target: { id: target }, ...rest }) => ({ source, target, ...rest }))\n          .map(link => existing.links.find(l => l.source.id === link.source.id && l.target.id === link.target.id) ?? link);\n        graph.graphData({ nodes, links });\n        if ( filter )\n          graph.nodeVal(node => matchingNodes.some(n => n.id === node.id) ? 3 : node.val);\n        else\n          graph.nodeVal('val');\n        document.querySelectorAll('[data-type=\"linkToggle\"]').forEach(applyLinkFilter);\n      };\n    });\n\n  </script>\n</body>"};
(()=>{function H(){return[]}function R(n,e){return e(n)}function Z(n){return JSON.parse(JSON.stringify(n))}function ee(n,e){Object.assign(n,e)}var Q=0;function F(n){let e=Math.max(0,n-(Date.now()-Q));return new Promise(t=>{setTimeout(()=>{Q=Date.now(),t()},e)})}function b(n){throw new Error(n)}async function te(){let n=document.createElement("input");return n.type="file",n.click(),new Promise(e=>{n.onchange=()=>{let t=n.files?.[0];if(!t)return e(void 0);let o=new FileReader;o.onload=()=>{e(o.result),n.remove()},o.readAsText(t)}})}function X(n){return n?new Date(n).getTime():0}function D(n,e=t=>t.created_at){return n.sort((t,o)=>X(e(t))-X(e(o)))}async function oe(n,e){for(let t of e.slice(e.findIndex(o=>o.id===n.id)+1))if(t!==n&&t.metadata.tags===n.metadata.tags&&await Ce(t.image_url,n.image_url))return console.warn(`Found potential base clip for cropped clip ${n.id}: ${t.id} (this is not guaranteed to be correct)`),t.id;console.warn(`Could not find a base clip for cropped clip ${n.id}, the clip will be mistakenly marked as a root clip.`)}async function ne(n){let t=await(await fetch(n)).blob();return new Promise((o,i)=>{let s=new Image;s.onload=()=>{URL.revokeObjectURL(s.src),o(s)},s.onerror=i,s.src=URL.createObjectURL(t)})}async function Ce(n,e){let t=await ne(n),o=await ne(e),i=document.createElement("canvas");i.width=t.width,i.height=t.height;let s=i.getContext("2d")??b("Canvas 2D context not supported");s.drawImage(t,0,0);let r=s.getImageData(0,0,t.width,t.height);s.drawImage(o,0,0);let c=s.getImageData(0,0,o.width,o.height),f=r.data,L=c.data,p=f.length,v=0;for(let w=0;w<p;w+=4)for(let E=0;E<3;E++)v+=Math.abs(f[w+E]-L[w+E]);let S=v/(p/4);return i.remove(),S<32;}function B(n,e){return n.find(be(e))}function be(n){return function(e){return Object.entries(n).every(([t,o])=>e[t]===o)}}var Le=0;function ie(n=""){return`${n}${++Le}`}function se(n,e){return Object.fromEntries(Object.entries(n).map(([t,o])=>[t,e(o,t)]))}function A(){return window.suno??b("`suno` object not found in `window`. Have you followed the setup instructions?")}var $=class{resolve;reject;promise;constructor(){this.promise=new Promise((e,t)=>Object.assign(this,{resolve:e,reject:t}))}};var ve="vovas",_="sunoTools",Ee=new Promise((n,e)=>{let t=indexedDB.open(ve,1);t.onupgradeneeded=()=>t.result.createObjectStore(_),t.onsuccess=()=>n(t.result),t.onerror=()=>e(t.error)});async function G(n){return(await Ee).transaction(_,n)}function re(n){return new Promise((e,t)=>{n.oncomplete=()=>e(),n.onerror=()=>t(n.error)})}async function Se(n){return(await G(n)).objectStore(_)}var N=class{constructor(e,t){this.key=e;this.init=t}async load(){let e=(await Se("readonly")).get(this.key);return new Promise((t,o)=>{e.onsuccess=()=>t(e.result??this.init),e.onerror=()=>o(e.error)})}async save(e){let t=await G("readwrite");return t.objectStore(_).put(e,this.key),re(t)}async clear(){let e=await G("readwrite");return e.objectStore(_).delete(this.key),re(e)}};var ae=Symbol("ref");function y(){return{[ae]:!0,value:void 0}}function Pe(n){if(n.value===void 0)throw new Error("Ref value is undefined")}function m(n){return Pe(n),n.value}function De(n){return n?.[ae]}var _e=["html","head","style","script","body","div","h3","p","a","img","audio","input","label","button"],{html:qe,head:Je,style:le,script:We,body:ze,div:g,h3:ce,p:de,a:pe,img:ue,audio:me,input:fe,label:Ie,button:V}=Re(_e);function Re(n){return n.reduce((e,t)=>Object.assign(e,{[t]:Be(t)}),{})}function Be(n){function e(...o){let i=De(o[0])?o.shift():void 0,s=Array.isArray(o[0])?void 0:o.shift(),r=o[0];return t(i,s,r)}function t(o,i,s){let r=document.createElement(n);return i&&(Object.assign(r,i),i.class&&(r.className=i.class),r instanceof HTMLLabelElement&&i.for&&(r.htmlFor=i.for),Object.entries(i.style??{}).forEach(([c,f])=>{r.style[c]=f})),s&&s.forEach(c=>{typeof c=="string"?r.appendChild(document.createTextNode(c)):r.appendChild(c)}),o&&(o.value=r),r}return e}var M=ye(fe,{type:"checkbox"}),he=ye(fe,{type:"text"});function ye(n,e){return(...t)=>{let o=n(...t);return Object.assign(o,e),o}}function j(n,e){e.id||=ie("pork-input-");let t=[Ie({for:e.id},[n]),e];return e.type==="checkbox"&&t.reverse(),t}async function ge(n,e,t){let o=n.document.createElement("script");return o.type="text/javascript",o.src=t,n.document.head.appendChild(o),new Promise(i=>{o.onload=()=>{i(n[e])}})}var Te=`
body { 
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

#sidebar {
  position: fixed;
  padding: 10px;
  top: 0;
  left: 0;
  bottom: 0;
  width: 200px;
  background-color: #333;
  color: #eee;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.f-row {
  display: flex;
  flex-direction: row;
}

.f-col {
  display: flex;
  flex-direction: column;
}

.smol {
  font-size: 0.8em;
  color: #aaa;
}

.relative {
  position: relative;
}

.absolute {
  position: absolute;
}

.topleft {
  top: 0;
  left: 0;
}

.p-1 {
  padding: 1rem;
};

.p-2 {
  padding: 2rem;
}

.w-100 {
  width: 100%;
}

.h-100 {
  height: 100%;
}

.j-between {
  justify-content: space-between;
}

.settings > div {
  margin-top: 5px;
}
`;async function ke(n,{in3D:e=!1,win:t=window}){let o=y(),i=y(),s=y(),r=y(),c=y(),f=y(),L=y(),p={container:y(),link:y(),image:y(),name:y(),tags:y(),audio:y()},v=await ge(t,"ForceGraph",`https://unpkg.com/${e?"3d-":""}force-graph`);t.document.head.appendChild(le([Te]));let S=g({style:{position:"fixed",top:"0px",left:"0px",width:"100%",height:"100%",backgroundColor:"#000",zIndex:"100"}},[g(o),g({id:"sidebar"},[g({class:"settings f-col"},[V(i,{style:{backgroundColor:"#444",color:"#eee",marginBottom:"5px"}},["Close Colony"]),ce(["Settings"]),g(j("Attract based on time",M(s,{checked:!0}))),g(r,j("Show time-based links",M(c))),g(j("Attract to root clip",M(f,{checked:!0}))),g([he(L,{placeholder:"Filter by name, style or ID"}),de({class:"smol"},["Enter to apply. (Filter will include both matching nodes and any nodes belonging to the same root clip.)"])])]),g(p.container,{class:"w-100",style:{display:"none"}},[g({class:"relative"},[pe(p.link,{target:"_blank"},[ue(p.image,{style:"opacity: 0.5",class:"w-100"})]),g({class:"absolute topleft",style:"width: 190px; padding: 5px;"},[g(p.name),g(p.tags,{class:"smol"})])]),me(p.audio,{controls:!0,class:"w-100"})])])]),w=V({style:{position:"fixed",top:"0px",left:"0px",padding:"5px",backgroundColor:"#444",color:"#eee",zIndex:"100"}},["Reopen Colony"]);function E(){t.document.body.appendChild(S),w.parentElement?.removeChild(w)}E(),m(i).addEventListener("click",()=>{t.document.body.removeChild(S),t.document.body.appendChild(w)}),w.addEventListener("click",()=>{E()});let C=new v(m(o)).graphData(n).backgroundColor("#001").linkAutoColorBy("kind").nodeAutoColorBy("rootId").linkLabel("kind").linkVisibility(W).linkDirectionalParticles(1).nodeLabel(({id:l,name:d,tags:x,image_url:u})=>`
      <div class="relative" style="width: 200px;">
        <img src="${u}" style="opacity: 0.5; width: 200px">
        <div class="absolute topleft" style="width: 190px; padding: 5px;">
          <div>${d||"[Untitled]"}</div>
          <div class="smol">${x||"(no style)"}</div>
        </div>
      </div>
      <div class="smol">
        Click to play, right-click to open in Suno
      </div>
    `).onNodeClick(({id:l,name:d,tags:x,image_url:u,audio_url:T})=>{m(p.container).style.display="block",m(p.link).href=`https://suno.com/song/${l}`,m(p.image).src=u,m(p.name).innerText=d||"[Untitled]",m(p.tags).innerText=x||"(no style)";let h=m(p.audio);h.src=T,h.play()}).onNodeRightClick(({id:l})=>{window.open(`https://suno.com/song/${l}`)});e?C.linkOpacity(l=>l.isMain?1:.2):C.linkLineDash(l=>l.isMain?null:[1,2]);let P=C.graphData();function W(l){return!{descendant:!0,next:!m(c).checked}[l.kind]}function z(l,d){let x=d.checked,{nodes:u,links:T}=C.graphData();if(x?T.push(...P.links.filter(h=>h.kind===l)):T=T.filter(h=>h.kind!==l),l==="next"&&(m(r).style.display=d.checked?"block":"none",T=T.filter(h=>h.kind!=="next"),d.checked)){D(u);for(let h=1;h<u.length;h++){let a=u[h-1],k=u[h];T.push({source:a.id,target:k.id,kind:"next",color:"#006",isMain:!1})}}C.graphData({nodes:u,links:T})}function Y(l=!1){se({next:s,descendant:f},(d,x)=>R(m(d),u=>{z(x,u),l&&u.addEventListener("change",()=>{z(x,u)})}))}Y(!0),m(c).addEventListener("change",()=>{C.linkVisibility(W)});function I(l){return typeof l=="string"?l:l.id}function U(l,d){return I(l)===I(d)}function K(l){return d=>U(l,d)}m(L).addEventListener("keyup",l=>{if(l.key==="Enter"){let d=m(L).value.toLowerCase(),x=d?P.nodes.filter(a=>`${a.id} ${a.name} ${a.tags} ${a.created_at}`.toLowerCase().includes(d)):P.nodes,u=C.graphData(),T=[...x.map(a=>u.nodes.find(K(a))??a),...d?P.nodes.filter(a=>x.some(k=>k.rootId===a.rootId&&k.id!==a.id)):[]].map(a=>u.nodes.find(k=>k.id===a.id)??a),h=P.links.filter(a=>T.some(K(a.source))&&T.some(K(a.target))).map(({source:a,target:k,...we})=>({source:I(a),target:I(k),...we})).map(a=>u.links.find(k=>U(a.source,k.source)&&U(a.target,k.target))??a);C.graphData({nodes:T,links:h}),d?C.nodeVal(a=>x.some(k=>k.id===a.id)?3:a.val):C.nodeVal("val"),Y()}}),setTimeout(()=>{m(s).click(),m(f).click()},2e3);return[S,w]}function xe(n,e){return Object.keys(e).reduce((t,o)=>t.replace(`___${o}___`,e[o]),n)}var $e=["next","descendant"];var q={rawClips:H(),lastProcessedPage:-1,allPagesProcessed:!1,links:H(),allLinksBuilt:!1},O=class{constructor(e=q){this.state=e;this.loadState()}reset(){this.state=q,console.log("Colony reset. Run build() to start building it again.")}storage=new N("colony",q);stateLoaded=new $;async loadState(e=!1){if(e){let t=await te();if(!t){console.log("No file selected, aborting.");return}this.state=JSON.parse(t)}else this.state=await this.storage.load();this.stateLoaded.resolve()}async saveState(e=!1){if(e){let t=JSON.stringify(this.state),o=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download="suno_colony.json",s.click(),URL.revokeObjectURL(i)}else await this.storage.save(this.state)}async build(){try{this.state.allPagesProcessed||await this.fetchClips(),this.state.allLinksBuilt||await this.buildLinks()}finally{await this.saveState()}}async fetchClips(){for(console.log("Fetching liked clips...");;){await F(1e3);let{data:{clips:e}}=await A().root.apiClient.GET("/api/feed/v2",{params:{query:{is_liked:!0,page:this.state.lastProcessedPage+1}}});if(!e.length){this.state.allPagesProcessed=!0;break}this.state.rawClips.push(...e),this.state.lastProcessedPage++,console.log(`Processed page ${this.state.lastProcessedPage}; total clips: ${this.state.rawClips.length}`)}}rawClipsById={};async loadClip(e){await F(1e3);console.log(`Clip ${e} not found in cache, loading...`);let t=await A().root.clips.loadClipById(e)??Me(e);return this.state.rawClips.push(t),t}getClipByIdSync(e){return this.rawClipsById[e]??=this.state.rawClips.find(t=>Ne(e)?t.audio_url.includes(e):t.id===e)}async getClipById(e){return e.startsWith("m_")&&(e=e.slice(2)),this.getClipByIdSync(e)??await this.loadClip(e)}async buildLinks(){console.log("Building links...");for(let e=0;e<this.state.rawClips.length;e++){let t=this.state.rawClips[e];e%100===0&&console.log(`Processed ${e} clips out of ${this.state.rawClips.length}`);let{metadata:o}=t,[i,s]="history"in o?R(o.history[0],r=>typeof r=="string"?[r,"extend"]:r.infill?[r.id,"inpaint"]:[r.id,"extend"]):"concat_history"in o?[o.concat_history[1].id,"apply"]:"cover_clip_id"in o?[o.cover_clip_id,"cover"]:"upsample_clip_id"in o?[o.upsample_clip_id,"remaster"]:"type"in o&&o.type==="edit_crop"?await oe(t,this.state.rawClips).then(r=>r?[r,"crop"]:[void 0,void 0]):[void 0,void 0];i&&this.state.links.push([(await this.getClipById(i)).id,t.id,s])}this.state.allLinksBuilt=!0,console.log(`Built ${this.state.links.length} links.`),console.log("Colony built. Run `await vovas.colony.render()` to view it!")}_linkedClips;get linkedClips(){return this._linkedClips??=this.getLinkedClips()}getLinkedClips(){let e=this.state.links.reduce((o,[i,s,r])=>{let c=B(o,{id:i})??b(`Could not find parent for link ${i} -> ${s}.`),f=B(o,{id:s})??b(`Could not find child for link ${i} -> ${s}.`);if(f.parent)throw new Error(`Child ${s} already has a parent: ${f.parent.clip.id}`);return f.parent={kind:r,clip:c},(c.children??=[]).push({kind:r,clip:f}),o},Z(this.state.rawClips));for(let o of e.filter(({parent:i})=>!i))t(o,o);return e;function t(o,i){Object.assign(o,{root:i});for(let{clip:s}of o.children??[])t(s,i)}}_rootClips;get rootClips(){return this._rootClips??=this.getRootClips()}getRootClips(){let e=this.linkedClips.filter(({parent:t})=>!t);return D(e)}get sortedClips(){let e=[],{rootClips:t}=this;for(let i of t)o(i);return e.reverse();function o(i){e.push(i);let{children:s}=i;if(s)for(let{clip:r}of D(s,({clip:c})=>c.created_at))o(r)}}get syntheticLinks(){let e=[],{rootClips:t}=this,o=t[0];for(let i of this.linkedClips.filter(({children:s})=>s?.length))e.push([(i.root??b(`Clip ${i.id} has no root.`)).id,i.id,"descendant"]);return e}getTotalDescendants(e){let t=B(this.linkedClips,{id:e})??b(`Clip ${e} not found.`);return t.totalDescendants??=1+(t.children?.reduce((o,{clip:{id:i}})=>o+this.getTotalDescendants(i),0)??0)}get graphData(){let e=this.sortedClips.map(({id:i,title:s,metadata:{tags:r},created_at:c,children:f,audio_url:L,image_url:p,root:v})=>({id:i,name:s||r||c||i,created_at:c,audio_url:L,image_url:p,tags:r,rootId:v?.id,val:i===v?.id&&f?.length?2:f?.length?1:.5})),t=([i,s,r])=>({source:i,target:s,kind:r,color:r==="next"?"#006":void 0,isMain:!$e.includes(r)&&this.getTotalDescendants(s)>1});return{nodes:e,links:[...this.syntheticLinks,...this.state.links].map(t)}}getHtml(e){let t=e?.toLowerCase()==="3d";return console.log("Rendering your colony, give it a few seconds..."),xe(window.templates.colony,{data:JSON.stringify(this.graphData),use3DGraph:String(t),GraphRenderer:t?"ForceGraph3D":"ForceGraph",graph_url_slug:t?"3d-force-graph":"force-graph"})}renderedElements=[];async render(...[e]){console.log("Rendering your colony, give it a few seconds..."),this.renderedElements=await ke(this.graphData,{in3D:e?.toLowerCase()==="3d"})}clear(){this.renderedElements.forEach(e=>e.remove()),this.renderedElements=[]}renderToFile(...e){let t=this.getHtml(...e),o=new Blob([t],{type:"text/html"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download="suno_colony.html",s.click(),URL.revokeObjectURL(i)}},J=new O;J.stateLoaded.promise.then(()=>{console.log("Welcome to Vova\u2019s Suno Colony! This is a nifty tool to visualize your liked clips and the relationships between them, such as extensions, inpaints, covers, etc., in a graph format. It takes a bit of time and hacks to build, but hopefully it\u2019ll be worth it!");let{state:{allPagesProcessed:n,allLinksBuilt:e}}=J;console.log(!n||!e?"Run `await vovas.colony.build()` to start or continue building your colony!":"Your colony is built, run `await vovas.colony.render()` to view it!")});function Ne(n){return n.match(/_\d+$/)}function Me(n){return console.warn(`Clip ${n} not found, creating a missing clip.`),{isMissing:!0,id:n,title:"*Clip not found*",created_at:null,audio_url:`https://cdn1.suno.ai/${n}.mp3`,image_url:"",metadata:{duration:0,tags:""}}}ee(window,{vovas:{Colony:O,colony:J}});})();

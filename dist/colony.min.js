(vovas = { main() {
(()=>{function Y(t,e){return t.find(ot(e))}function ot(t){return function(e){return Object.entries(t).every(([n,o])=>e[n]===o)}}var Le={};function L(t=""){return Le[t]??=0,`${t}${++Le[t]}`}function X(t,e){return Object.fromEntries(Object.entries(t).map(([n,o])=>[n,e(o,n)]))}function Ie(t,e){return X(t,e)}function U(t){return typeof t=="function"}function Ke(t){return t}function Ee(t,e){return Object.assign(t,e)}function Me(t){return t.filter(Boolean)}function me(t){return Object.values(t)}var wt=Symbol("NOT_SET");function C(t){return t}var vt=Symbol("brand");function F(t,e){return U(t)?t(e):t}function ye(){return[]}function E(t,e){return e(t)}function Q(t){return JSON.parse(JSON.stringify(t))}function M(t,e){Object.assign(t,e)}function Be(t,e){return M(t,e),t}var De=0;function ge(t){let e=Math.max(0,t-(Date.now()-De));return new Promise(n=>{setTimeout(()=>{De=Date.now(),n()},e)})}function x(t){throw new Error(t)}async function je(){let t=document.createElement("input");return t.type="file",t.click(),new Promise(e=>{t.onchange=()=>{let n=t.files?.[0];if(!n)return e(void 0);let o=new FileReader;o.onload=()=>{e(o.result),t.remove()},o.readAsText(n)}})}function Pe(t){return t?new Date(t).getTime():0}function $(t,e=n=>n.created_at){return t.sort((n,o)=>Pe(e(n))-Pe(e(o)))}function he(t){if(typeof t=="function")return function(...e){debugger;return t(...e)};debugger;return t}function Fe(t,e){return e(t),t}function D(t,e,n){if(t.has(e))return t.get(e);let o=F(n,e);return t.set(e,o),o}function rt(...[t,e]){if(U(t))return n(t,e);{let o=t;return n(()=>o,r=>o=r)}function n(o,r){return function i(l){if(l===void 0)return o();if(!r)throw new TypeError("Cannot set value on a read-only box");return U(l)?i(l(o())):(r(l),l)}}}function $e(...t){return rt(...t)}var Lt=Symbol("typeMarker");async function Oe(t,e){for(let n of e.slice(e.findIndex(o=>o.id===t.id)+1))if(n!==t&&n.metadata.tags===t.metadata.tags&&await at(n.image_url,t.image_url))return console.warn(`Found potential base clip for cropped clip ${t.id}: ${n.id} (this is not guaranteed to be correct)`),n.id;console.warn(`Could not find a base clip for cropped clip ${t.id}, the clip will be mistakenly marked as a root clip.`)}async function _e(t){let n=await(await fetch(t)).blob();return new Promise((o,r)=>{let i=new Image;i.onload=()=>{URL.revokeObjectURL(i.src),o(i)},i.onerror=r,i.src=URL.createObjectURL(n)})}async function at(t,e){let n=await _e(t),o=await _e(e),r=document.createElement("canvas");r.width=n.width,r.height=n.height;let i=r.getContext("2d")??x("Canvas 2D context not supported");i.drawImage(n,0,0);let l=i.getImageData(0,0,n.width,n.height);i.drawImage(o,0,0);let d=i.getImageData(0,0,o.width,o.height),u=l.data,g=d.data,y=u.length,w=0;for(let A=0;A<y;A+=4)for(let R=0;R<3;R++)w+=Math.abs(u[A+R]-g[A+R]);let k=w/(y/4);return r.remove(),k<32;}var Z=class{resolve;reject;promise;constructor(){this.promise=new Promise((e,n)=>Object.assign(this,{resolve:e,reject:n}))}};var it="vovas",_="sunoTools",st=new Promise((t,e)=>{let n=indexedDB.open(it,1);n.onupgradeneeded=()=>n.result.createObjectStore(_),n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)});async function xe(t){return(await st).transaction(_,t)}function We(t){return new Promise((e,n)=>{t.oncomplete=()=>e(),t.onerror=()=>n(t.error)})}async function lt(t){return(await xe(t)).objectStore(_)}var ee=class{constructor(e,n){this.key=e;this.init=n}async load(){let e=(await lt("readonly")).get(this.key);return new Promise((n,o)=>{e.onsuccess=()=>n(e.result??this.init),e.onerror=()=>o(e.error)})}async save(e){let n=await xe("readwrite");return n.objectStore(_).put(e,this.key),We(n)}async clear(){let e=await xe("readwrite");return e.objectStore(_).delete(this.key),We(e)}};var te=function(){let t=this.constructor.prototype.call;function e(){return t.apply(e,arguments)}return Object.setPrototypeOf(e,this.constructor.prototype),Object.getOwnPropertyNames(this).forEach(n=>{Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n)??x(`Failed to get descriptor for ${n}`))}),e};te.prototype=Object.create(Function.prototype);var be=class extends te{call(e){return e.length}otherMethod(){return"hello"}},Ve=new be;console.log(Ve("hello"));console.log(Ve.otherMethod());var oe=class extends Error{constructor(e){super(`smork: ${e}`)}};function ct(t){return t&&typeof t=="object"&&me(t).every(e=>e instanceof b)}function h(t,e){return U(t)?ut(t,e):ct(t)?new O(()=>X(t,Re),me(t)):new re(t)}var dt=Symbol("NotApplicable"),b=class extends te{constructor(n){super();this._value=n;P&&ae.add(this)}watchers=new Set;activeWatchers=new WeakSet;targets=new Set;id=L("ref-");name=C();named(n){return Be(this,{name:n})}get(){return ne?.(this),this._value}_set(n){let{_value:o}=this;if(n!==o){this._value=n,this.tarnishTargets();try{for(let r of this.watchers)this.activeWatchers.has(r)&&console.warn("smork: watcher is already active \u2014 perhaps a circular dependency \u2014 exiting watch to prevent infinite loop"),this.activeWatchers.add(r),r(n,o)}finally{this.activeWatchers=new WeakSet}}}call=$e(()=>this.get());tarnishTargets(){this.targets.forEach(n=>n.tarnish())}watchImmediate(n){n(this.value,dt),this.watch(n)}watch(n){this.watchers.add(n)}unwatch(n){this.watchers.delete(n)}get value(){return this.get()}map(n){let o=new W(this,n);return U(o.value)?(this.targets.delete(o),o.sources.clear(),(...r)=>new W(this,i=>n(i)(...r))):o}mapDefined(n){return this.map(o=>o!==void 0?n(o):void 0)}uses(n){return Ee(this,X(n,this.map))}setter(n=o=>this._set(o)){return new ve(this,n)}},Ge=new b(5),Wt=Ge(),Vt=Ge(5),ne,O=class extends b{constructor(n,o=C()){super(void 0);this.getter=n;this.sources=new Set(o),(this.sourcesPredefined=!!o)&&o.forEach(r=>r.targets.add(this))}sources;sourcesPredefined=!1;dirty=!0;tarnish(){this.dirty||(this.dirty=!0,this.watchers.size?this.recalculate():this.tarnishTargets())}get(){return this.dirty&&this.recalculate(),super.get()}recalculate(){if(this.sourcesPredefined)return this.update();if(ne)throw new oe("Tried to compute a ref while another one is already being computed \u2014 did you nest a computed ref in another ref's getter function?");this.sources.forEach(n=>n.targets.delete(this)),this.sources.clear();try{ne=n=>{this.sources.add(n),n.targets.add(this)},this.update()}finally{ne=void 0}}update=()=>{this._set(this.getter()),this.dirty=!1}};function ut(t,e){return E(new O(t),n=>e?n.setter(e):n)}var W=class extends O{constructor(n,o){super(()=>o(n.value),[n]);this.source=n}},re=class extends b{set(e){this._set(e)}set value(e){this.set(e)}get value(){return this.get()}bridge(e,n){return this.map(e).setter(o=>this.set(n(o)))}clone(){return new we(this)}},we=class extends W{constructor(n){super(n,Ke);this.source=n}},ve=class extends re{constructor(n,o,r=!1){super(n.value);this.source=n;this.allowMismatch=r;super.watch(ke(this))}set(n){if(super.set(n),!this.allowMismatch&&this.value!==n)throw new oe("Setter did not update the value. If you want to allow this, set the allowMismatch property to true.")}};function ke(t){return e=>{t.set(e)}}function Re(t){return t instanceof b?t.value:t}function He(t){return t instanceof b?t:new b(t)}var P=!0,ae=new Set,V=new Set,G=new Map;async function pt(){let t=await ie("ForceGraph","https://unpkg.com/force-graph"),e,n,o=h(!1).named("minimized"),r=o.map(a=>a?"10":"70");document.body.appendChild(e=T({style:"position: fixed; top: 0; right: 0; z-index: 300; background: #eee; padding: 1em;"},[T({style:"position: relative;"},[n=T({style:r.map(a=>`height: ${a}vh; width: ${a}vw; overflow: auto`)}),N({style:"position: absolute; top: 0; left: 0; color: black",onclick:()=>e.remove()},["X"]),N({style:"position: absolute; top: 0; right: 0; color: black",onclick:()=>o.set(!o.value)},[B(o,"\u2199","\u2197")])])]));let i=[...ae],l=i.map(a=>({id:a.id,ref:a,class:a.constructor.name,name:`${a.name??a.id} (${a.constructor.name}) = ${Array.isArray(a.value)?`${a.value.length} \u2715 ${a.value[0]?.constructor.name}`:a.value?.toString()}`,val:3})),d=l.map(({id:a,ref:{targets:f}})=>[...f].map(({id:p})=>({source:a,target:p}))).flat(),u=i.map(({watchers:a})=>[...a].map(f=>({id:L("watcher-"),watcher:f,class:"watcher",name:`${f.toString()}`}))).flat(),g=new Map(u.map(({watcher:a,id:f})=>[a,f])),y=i.map(({id:a,watchers:f})=>[...f].map(p=>({source:a,target:g.get(p)??x(`Watcher ${p} has no ID.`)})).flat()).flat();function w(a){return{id:L("el-"),element:a,class:a.constructor.name,name:`${a.tagName}#${a.id||""}.${a.className}`,val:a.querySelectorAll("*").length}}let k=[...V].map(w),A=new Map,R=a=>{let f=(k.find(({element:p})=>p===a)??(()=>{let p=w(a);return k.push(p),p})()).id;return D(A,a,f)},H=[...[...G].map(([{id:a},f])=>[...f].map(p=>({source:a,target:R(p)}))).flat(),...[...V].map(a=>[...a.children].filter(p=>p instanceof HTMLElement).map(p=>({source:R(a),target:R(p)}))).flat()],z=[...l,...k,...u],S=[...d,...H,...y],ue={nodes:z,links:S},q=a=>"#"+(a*1234567%Math.pow(2,24)).toString(16).padStart(6,"0"),pe=0,J=new Map,fe=a=>q(D(J,a,++pe));new t(n).graphData(ue).onNodeClick(({ref:a,element:f,watcher:p})=>{console.log(...a?[a._value,a]:[f??p]),M(window,{$:a??f??p})}).nodeAutoColorBy("class").nodeCanvasObjectMode(({ref:a,element:f})=>a?"after":f&&"replace").nodeCanvasObject(({ref:a,element:f,x:p,y:I,val:Te},v)=>{a?.name&&p&&I&&(v.font="10px Arial",v.fillText(a.name,p+10,I)),f&&p&&I&&(v.beginPath(),v.arc(p,I,Math.sqrt(Number(Te)+1),0,2*Math.PI,!1),v.fillStyle="white",v.fill(),v.lineWidth=2,v.strokeStyle=fe(f.tagName),v.stroke())}).linkLineDash(({target:a})=>typeof a=="object"&&a.element?[4,2]:null).linkDirectionalParticles(1);let j={refNodes:l,elementNodes:k,refLinks:d,watcherLinks:y,elementLinks:H};M(window.smork,j),console.log(j)}Object.assign(window,{smork:{devTools:pt,allRefs:ae,allElements:V,refToElementLinks:G}});var ze=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function Se(t){function e(o,r){let[i,l]=Array.isArray(o)?[void 0,o]:[o,r];return n(i,l)}return e;function n(o,r){let i=document.createElement(t);return P&&V.add(i),o&&Ie(o,(l,d)=>{typeof l=="function"?i[d]=l:E(l,u=>{g(Re(u)),He(u).watch(g),P&&u instanceof b&&D(G,u,new Set).add(i);function g(y){typeof y=="boolean"?y?i.setAttribute(d,""):i.removeAttribute(d):i.setAttribute(d,String(y))}})}),r&&r.forEach(l=>{let d=C(),u=g=>{let y=typeof g=="string"?document.createTextNode(g):g instanceof HTMLElement?g:document.createComment("");d?d.replaceWith(y):i.appendChild(y),d=y};l instanceof b?l.watchImmediate(u):u(l),P&&l instanceof b&&D(G,l,new Set).add(i)}),i}}var{a:qe,abbr:bn,address:wn,area:vn,article:kn,aside:Rn,audio:Je,b:Sn,base:Cn,bdi:An,bdo:Un,blockquote:Nn,body:Ln,br:In,button:N,canvas:Kn,caption:En,cite:Mn,code:Dn,col:Pn,colgroup:Bn,data:jn,datalist:Fn,dd:$n,del:_n,details:On,dfn:Wn,dialog:Vn,div:T,dl:Gn,dt:Hn,em:zn,embed:qn,fieldset:Jn,figcaption:Yn,figure:Xn,footer:Qn,form:Zn,h1:eo,h2:to,h3:Ye,h4:no,h5:oo,h6:ro,head:ao,header:io,hgroup:so,hr:lo,html:co,i:uo,iframe:po,img:Xe,input:fo,ins:To,kbd:mo,label:ft,legend:yo,li:go,link:ho,main:xo,map:bo,mark:wo,menu:vo,meta:ko,meter:Ro,nav:So,noscript:Co,object:Ao,ol:Uo,optgroup:No,option:Lo,output:Io,p:Qe,picture:Ko,pre:Eo,progress:Mo,q:Do,rp:Po,rt:Bo,ruby:jo,s:Fo,samp:$o,script:Tt,search:_o,section:Oo,select:Wo,slot:Vo,small:Go,source:Ho,span:zo,strong:qo,style:Ze,sub:Jo,summary:Yo,sup:Xo,table:Qo,tbody:Zo,td:er,template:tr,textarea:nr,tfoot:or,th:rr,thead:ar,time:ir,title:sr,tr:lr,track:cr,u:dr,ul:ur,var:pr,video:fr,wbr:Tr}=ze.reduce((t,e)=>(t[e]=Se(e),t),{});function se(t,e){return Se("input")({...e,type:"checkbox",checked:t,onchange:()=>t.set(!t.value)})}function et(t,e){return Se("input")({...e,type:"text",value:t,onkeyup:({key:n,target:o})=>{n==="Enter"&&o instanceof HTMLInputElement&&t.set(o.value)}})}function le(t,e){e.id||=L("smork-input-");let n=[ft({for:e.id},[t]),e];return e.type==="checkbox"&&n.reverse(),n}async function ie(t,e){return window[t]?window[t]:new Promise(n=>{document.head.appendChild(Tt({src:e,onload:()=>n(window[t])}))})}function B(t,e,n=C()){return t.map(o=>o?F(e,o):F(n))}function Ce({id:t,image_url:e,name:n,tags:o}){return T({class:"relative"},[qe({href:`https://suno.com/song/${t}`,target:"_blank"},[Xe({src:e,style:"opacity: 0.5; width: 200px"}),T({class:"absolute topleft",style:"width: 190px; padding: 5px"},[T([n||"[Untitled]"]),T({class:"smol"},[o||"(no style)"])])])])}var tt='.colony { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;}.colony button {background-color: #444;color: #eee}.colony #sidebar {position: fixed;padding: 10px;top: 0;left: 0;bottom: 0;width: 200px;background-color: #333;color: #eee;display: flex;flex-direction: column;justify-content: space-between;}.colony .f-row {display: flex;flex-direction: row;}.colony .f-col {display: flex;flex-direction: column;}.colony .smol {font-size: 0.8em;color: #aaa;}.colony .relative {position: relative;}.colony .absolute {position: absolute;}.colony .topleft {top: 0;left: 0;}.colony .p-1 {padding: 1rem;};.colony .p-2 {padding: 2rem;}.colony .w-100 {width: 100%;}.colony .h-100 {height: 100%;}.colony .j-between {justify-content: space-between;}.colony .settings > * {margin-top: 5px;}';async function Ae(t,e,{mode:n=C()}){let o=Q(e);let r=n?.toLowerCase()==="3d",i=h(!1).named("hideUI"),l=i.map(s=>!s).named("showUI"),d=h(!0).named("useNextLinks"),u=h(!0).named("useDescendantLinks"),g=h("").named("filterString"),y=h(!1).named("showNextLinks"),w=h().named("audioElement"),k=h().named("selectedClip");k.watch(()=>setTimeout(()=>{w()?.play()},0));let A=new Map;function R(s){return A.get(s)??Fe(o?.nodes.find(c=>c.id===s)??x(`Node with ID ${s} not found.`),c=>A.set(s,c))}let H=await ie("ForceGraph",`https://unpkg.com/${r?"3d-":""}force-graph`);window.document.head.appendChild(Ze([tt]));let z=T(),S=new H(z).graphData(o).backgroundColor("#001").linkAutoColorBy("kind").nodeAutoColorBy("rootId").linkLabel("kind").linkDirectionalParticles(1).nodeLabel(s=>T([Ce(s),T({class:"smol"},["Click to play, right-click to open in Suno"])]).outerHTML).onNodeClick(ke(k)).onNodeRightClick(({id:s})=>{window.open(`https://suno.com/song/${s}`)});r?S.linkOpacity(s=>s.isMain?1:.2):S.linkLineDash(s=>s.isMain?null:[1,2]),Object.assign(window,{graph:S});async function ue(){new FinalizationRegistry(()=>console.log("Previous graph destroyed, container removed from memory")).register(S,""),S._destructor(),v.remove(),await Ae(this,e,{mode:n})}y.watchImmediate(s=>{S.linkVisibility(c=>!{descendant:!0,next:!s}[c.kind])});function q(s){return typeof s=="string"?s:s.id}function pe(s,c){return q(s)===q(c)}function J(s){return c=>pe(s,c)}let fe=h(Date.now).named("graphLastUpdated"),j=g.map(s=>{let{nodes:c}=o;return s?(s=s.toLowerCase(),c.filter(m=>`${m.id} ${m.name} ${m.tags} ${m.created_at}`.toLowerCase().includes(s))):c}).named("matchingNodes");j.watchImmediate(s=>S.nodeVal(c=>s.some(m=>m.id===c.id)?3:c.val));let a=h({filter:g,nodes:j}).map(({filter:s,nodes:c})=>s?[...c,...o.nodes?.filter(m=>!c.includes(m)&&c.some(K=>K.rootId===m.rootId))??[]]:c).named("nodes"),f=a.map(s=>s?o.links.filter(c=>s.some(J(c.source))&&s.some(J(c.target))):[]).named("linksBetweenFilteredNodes"),p=h({nodes:a,useNextLinks:d}).map(({nodes:s,useNextLinks:c})=>!s||!c?[]:($(s),s.filter(m=>m.rootId===m.id).slice(1).map((m,K)=>({source:s[K].id,target:m.id,kind:"next",color:"#006",isMain:!1})))).named("nextLinks"),I=h({nodes:a,useDescendantLinks:u}).map(({nodes:s,useDescendantLinks:c})=>!s||!c?[]:Me(s.map(m=>{let K=R(m.rootId??x(`Node ${m.id} has no root ID.`));return K!==m?{source:K.id,target:m.id,kind:"descendant",isMain:!1}:null}))).named("descendantLinks"),Te=h({linksBetweenFilteredNodes:f,nextLinks:p,descendantLinks:I}).map(({linksBetweenFilteredNodes:s,nextLinks:c,descendantLinks:m})=>[...s,...c,...m]).named("links");h({nodes:a,links:Te}).named("graphData").watchImmediate(s=>{S.graphData(s),fe.update()}),setTimeout(()=>{d(!1),u(!1)},2e3);let v=document.body.appendChild(T({class:"colony",style:"position: fixed; top: 0px; left: 0px; z-index: 100;"},[B(l,T({style:"flex-direction: column; height: 100vh; width: 100vh; background-color: #000;"},[z,T({id:"sidebar"},[T({class:"settings f-col"},[N({style:"margin-bottom: 5px;",onclick:()=>i(!0)},["Close Colony"]),Ye(["Settings"]),T(le("Attract based on time",se(d))),B(d,T(le("Show time-based links",se(y)))),T(le("Attract to root clip",se(u))),T([et(g,{placeholder:"Filter by name, style or ID"}),Qe({class:"smol"},["Enter to apply. (Filter will include both matching nodes and any nodes belonging to the same root clip.)"])]),N({onclick:ue},["Redraw"]),N({onclick:()=>t.renderToFile(n)},["Download"])]),B(k,s=>T({class:"w-100"},[Ce(s),w(Je({src:s.audio_url,controls:!0,class:"w-100"}))]))])]),N({style:"position: fixed; top: 0px; left: 0px; padding: 5px; z-index: 100;",onclick:()=>i(!1)},["Reopen Colony"]))]))}var mt="https://studio-api.prod.suno.com/api/";function nt(t,e){return async(...n)=>{let o=t(...n),r=await fetch(mt+o,{headers:{authorization:`Bearer ${await window.Clerk.session.getToken()}`}});if(r.status===404&&e){console.warn(`Could not find resource at ${o}, returning undefined`);return}return await r.json()}}var Ue={getClips:nt(t=>"feed/v2?is_liked=true&page="+t),getClip:nt(t=>"clip/"+t,!0)};var yt=["next","descendant"];var Ne={rawClips:ye(),lastProcessedPage:-1,allPagesProcessed:!1,links:ye(),allLinksBuilt:!1},de=class{constructor(e=Ne){this.state=e;this.loadState()}reset(){this.state=Ne,console.log("Colony reset. Run build() to start building it again.")}storage=new ee("colony",Ne);stateLoaded=new Z;async loadState(e=!1){if(e){let n=await je();if(!n){console.log("No file selected, aborting.");return}this.state=JSON.parse(n)}else this.state=await this.storage.load();this.stateLoaded.resolve()}async saveState(e=!1){if(e){let n=JSON.stringify(this.state),o=new Blob([n],{type:"application/json"}),r=URL.createObjectURL(o),i=document.createElement("a");i.href=r,i.download="suno_colony.json",i.click(),URL.revokeObjectURL(r)}else await this.storage.save(this.state)}async build(){try{this.state.allPagesProcessed||await this.fetchClips(),this.state.allLinksBuilt||await this.buildLinks()}finally{await this.saveState()}}async fetchClips(){for(console.log("Fetching liked clips...");;){await ge(1e3);let{clips:e}=await Ue.getClips(this.state.lastProcessedPage+1);if(!e.length){this.state.allPagesProcessed=!0;break}this.state.rawClips.push(...e),this.state.lastProcessedPage++,console.log(`Processed page ${this.state.lastProcessedPage}; total clips: ${this.state.rawClips.length}`)}}rawClipsById={};async loadClip(e){await ge(1e3);console.log(`Clip ${e} not found in cache, loading...`);let n=await Ue.getClip(e)??ht(e);return this.state.rawClips.push(n),n}getClipByIdSync(e){return this.rawClipsById[e]??=this.state.rawClips.find(n=>gt(e)?n.audio_url.includes(e):n.id===e)}async getClipById(e){return e.startsWith("m_")&&(e=e.slice(2)),this.getClipByIdSync(e)??await this.loadClip(e)}async buildLinks(){console.log("Building links...");for(let e=0;e<this.state.rawClips.length;e++){let n=this.state.rawClips[e];e%100===0&&console.log(`Processed ${e} clips out of ${this.state.rawClips.length}`);let{metadata:o}=n,[r,i]="history"in o?E(o.history[0],l=>typeof l=="string"?[l,"extend"]:l.infill?[l.id,"inpaint"]:[l.id,"extend"]):"concat_history"in o?[o.concat_history[1].id,"apply"]:"cover_clip_id"in o?[o.cover_clip_id,"cover"]:"upsample_clip_id"in o?[o.upsample_clip_id,"remaster"]:"type"in o&&o.type==="edit_crop"?await Oe(n,this.state.rawClips).then(l=>l?[l,"crop"]:[void 0,void 0]):[void 0,void 0];r&&this.state.links.push([(await this.getClipById(r)).id,n.id,i])}this.state.allLinksBuilt=!0,console.log(`Built ${this.state.links.length} links.`),console.log("Colony built. Run `await vovas.colony.render()` to view it!")}_linkedClips;get linkedClips(){return this._linkedClips??=this.getLinkedClips()}getLinkedClips(){let e=this.state.links.reduce((o,[r,i,l])=>{let d=Y(o,{id:r})??x(`Could not find parent for link ${r} -> ${i}.`),u=Y(o,{id:i})??x(`Could not find child for link ${r} -> ${i}.`);if(u.parent)throw new Error(`Child ${i} already has a parent: ${u.parent.clip.id}`);return u.parent={kind:l,clip:d},(d.children??=[]).push({kind:l,clip:u}),o},Q(this.state.rawClips));for(let o of e.filter(({parent:r})=>!r))n(o,o);return e;function n(o,r){Object.assign(o,{root:r});for(let{clip:i}of o.children??[])n(i,r)}}_rootClips;get rootClips(){return this._rootClips??=this.getRootClips()}getRootClips(){let e=this.linkedClips.filter(({parent:n})=>!n);return $(e)}get sortedClips(){let e=[],{rootClips:n}=this;for(let r of n)o(r);return e.reverse();function o(r){e.push(r);let{children:i}=r;if(i)for(let{clip:l}of $(i,({clip:d})=>d.created_at))o(l)}}get syntheticLinks(){let e=[];return e}getTotalDescendants(e){let n=Y(this.linkedClips,{id:e})??x(`Clip ${e} not found.`);return n.totalDescendants??=1+(n.children?.reduce((o,{clip:{id:r}})=>o+this.getTotalDescendants(r),0)??0)}_graphData=C();getGraphData(){let e=this.sortedClips.map(({id:r,title:i,metadata:{tags:l},created_at:d,children:u,audio_url:g,image_url:y,root:w})=>({id:r,name:i||l||d||r,created_at:d,audio_url:g,image_url:y,tags:l,rootId:w?.id,val:r===w?.id&&u?.length?2:u?.length?1:.5})),n=([r,i,l])=>({source:r,target:i,kind:l,color:l==="next"?"#006":void 0,isMain:!yt.includes(l)&&this.getTotalDescendants(i)>1});return{nodes:e,links:[...this.syntheticLinks,...this.state.links].map(n)}}get graphData(){return this._graphData??=this.getGraphData()}getHtml(e){return console.log("Rendering your colony, give it a few seconds..."),`<script>(vovas = {${window.vovas.main.toString()}}).main();vovas.colony.render(...${JSON.stringify([e,this.graphData])})<\/script>`}async render(e,n){console.log("Rendering your colony, give it a few seconds..."),this._graphData??=n,await Ae(this,this.graphData,{mode:e})}renderToFile(...e){let n=this.getHtml(...e),o=new Blob([n],{type:"text/html"}),r=URL.createObjectURL(o),i=document.createElement("a");i.href=r,i.download="suno_colony.html",i.click(),URL.revokeObjectURL(r)}},ce=new de;ce.stateLoaded.promise.then(async()=>{console.log("Welcome to Vova\u2019s Suno Colony! This is a nifty tool to visualize your liked clips and the relationships between them, such as extensions, inpaints, covers, etc., in a graph format. It takes a bit of time and hacks to build, but hopefully it\u2019ll be worth it!");let{state:{allPagesProcessed:t,allLinksBuilt:e}}=ce;!t||!e?console.log("Run `await vovas.colony.build()` to start or continue building your colony!"):(console.log("Your colony is built, rendering!"),await ce.render())});function gt(t){return t.match(/_\d+$/)}function ht(t){return console.warn(`Clip ${t} not found, creating a missing clip.`),{isMissing:!0,id:t,title:"*Clip not found*",created_at:null,audio_url:`https://cdn1.suno.ai/${t}.mp3`,image_url:"",metadata:{duration:0,tags:""}}}M(window.vovas,{Colony:de,colony:ce,debug:he});he();})();
}}).main();

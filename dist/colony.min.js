(vovas = { main() {
(()=>{function Y(e,t){return e.find(ot(t))}function ot(e){return function(t){return Object.entries(e).every(([n,o])=>t[n]===o)}}var Ne={};function N(e=""){return Ne[e]??=0,`${e}${++Ne[e]}`}function X(e,t){return Object.fromEntries(Object.entries(e).map(([n,o])=>[n,t(o,n)]))}function Ke(e,t){return X(e,t)}function L(e){return typeof e=="function"}function Ee(e){return e}function Ue(e,t){return Object.assign(e,t)}function De(e){return e.filter(Boolean)}function me(e){return Object.values(e)}var wt=Symbol("NOT_SET");function C(e){return e}var vt=Symbol("brand");function F(e,t){return L(e)?e(t):e}function ye(){return[]}function U(...e){return e.pop()(...e)}function Q(e){return JSON.parse(JSON.stringify(e))}function D(e,t){Object.assign(e,t)}function Be(e,t){return D(e,t),e}var Me=0;function ge(e){let t=Math.max(0,e-(Date.now()-Me));return new Promise(n=>{setTimeout(()=>{Me=Date.now(),n()},t)})}function x(e){throw e instanceof Error?e:new Error(e)}async function je(){let e=document.createElement("input");return e.type="file",e.click(),new Promise(t=>{e.onchange=()=>{let n=e.files?.[0];if(!n)return t(void 0);let o=new FileReader;o.onload=()=>{t(o.result),e.remove()},o.readAsText(n)}})}function Pe(e){return e?new Date(e).getTime():0}function $(e,t=n=>n.created_at){return e.sort((n,o)=>Pe(t(n))-Pe(t(o)))}function he(e){if(typeof e=="function")return function(...t){debugger;return e(...t)};debugger;return e}function Fe(e,t){return t(e),e}function M(e,t,n){if(e.has(t))return e.get(t);let o=F(n,t);return e.set(t,o),o}function rt(...[e,t]){if(L(e))return n(e,t);{let o=e;return n(()=>o,r=>o=r)}function n(o,r){return function i(l){if(l===void 0)return o();if(!r)throw new TypeError("Cannot set value on a read-only box");return L(l)?i(l(o())):(r(l),l)}}}function $e(...e){return rt(...e)}var Et=Symbol("typeMarker");async function Oe(e,t){for(let n of t.slice(t.findIndex(o=>o.id===e.id)+1))if(n!==e&&n.metadata.tags===e.metadata.tags&&await at(n.image_url,e.image_url))return console.warn(`Found potential base clip for cropped clip ${e.id}: ${n.id} (this is not guaranteed to be correct)`),n.id;console.warn(`Could not find a base clip for cropped clip ${e.id}, the clip will be mistakenly marked as a root clip.`)}async function _e(e){let n=await(await fetch(e)).blob();return new Promise((o,r)=>{let i=new Image;i.onload=()=>{URL.revokeObjectURL(i.src),o(i)},i.onerror=r,i.src=URL.createObjectURL(n)})}async function at(e,t){let n=await _e(e),o=await _e(t),r=document.createElement("canvas");r.width=n.width,r.height=n.height;let i=r.getContext("2d")??x("Canvas 2D context not supported");i.drawImage(n,0,0);let l=i.getImageData(0,0,n.width,n.height);i.drawImage(o,0,0);let d=i.getImageData(0,0,o.width,o.height),u=l.data,g=d.data,y=u.length,w=0;for(let A=0;A<y;A+=4)for(let R=0;R<3;R++)w+=Math.abs(u[A+R]-g[A+R]);let k=w/(y/4);return r.remove(),k<32;}var Z=class{resolve;reject;promise;constructor(){this.promise=new Promise((t,n)=>Object.assign(this,{resolve:t,reject:n}))}};var it="vovas",_="sunoTools",st=new Promise((e,t)=>{let n=indexedDB.open(it,1);n.onupgradeneeded=()=>n.result.createObjectStore(_),n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)});async function xe(e){return(await st).transaction(_,e)}function We(e){return new Promise((t,n)=>{e.oncomplete=()=>t(),e.onerror=()=>n(e.error)})}async function lt(e){return(await xe(e)).objectStore(_)}var ee=class{constructor(t,n){this.key=t;this.init=n}async load(){let t=(await lt("readonly")).get(this.key);return new Promise((n,o)=>{t.onsuccess=()=>n(t.result??this.init),t.onerror=()=>o(t.error)})}async save(t){let n=await xe("readwrite");return n.objectStore(_).put(t,this.key),We(n)}async clear(){let t=await xe("readwrite");return t.objectStore(_).delete(this.key),We(t)}};var te=function(){let e=this.constructor.prototype.call;function t(){return e.apply(t,arguments)}return Object.setPrototypeOf(t,this.constructor.prototype),Object.getOwnPropertyNames(this).forEach(n=>{Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n)??x(`Failed to get descriptor for ${n}`))}),t};te.prototype=Object.create(Function.prototype);var be=class extends te{call(t){return t.length}otherMethod(){return"hello"}},Ve=new be;console.log(Ve("hello"));console.log(Ve.otherMethod());var oe=class extends Error{constructor(t){super(`smork: ${t}`)}};function ct(e){return e&&typeof e=="object"&&me(e).every(t=>t instanceof b)}function h(e,t){return L(e)?ut(e,t):ct(e)?new O(()=>X(e,Re),me(e)):new re(e)}var dt=Symbol("NotApplicable"),b=class extends te{constructor(n){super();this._value=n;P&&ae.add(this)}watchers=new Set;activeWatchers=new WeakSet;targets=new Set;id=N("ref-");name=C();named(n){return Be(this,{name:n})}get(){return ne?.(this),this._value}_set(n){let{_value:o}=this;if(n!==o){this._value=n,this.tarnishTargets();try{for(let r of this.watchers)this.activeWatchers.has(r)&&console.warn("smork: watcher is already active \u2014 perhaps a circular dependency \u2014 exiting watch to prevent infinite loop"),this.activeWatchers.add(r),r(n,o)}finally{this.activeWatchers=new WeakSet}}}call=$e(()=>this.get());tarnishTargets(){this.targets.forEach(n=>n.tarnish())}watchImmediate(n){n(this.value,dt),this.watch(n)}watch(n){this.watchers.add(n)}unwatch(n){this.watchers.delete(n)}get value(){return this.get()}map(n){let o=new W(this,n);return L(o.value)?(this.targets.delete(o),o.sources.clear(),(...r)=>new W(this,i=>n(i)(...r))):o}mapDefined(n){return this.map(o=>o!==void 0?n(o):void 0)}uses(n){return Ue(this,X(n,this.map))}setter(n=o=>this._set(o)){return new ve(this,n)}},Ge=new b(5),Gt=Ge(),Ht=Ge(5),ne,O=class extends b{constructor(n,o=C()){super(void 0);this.getter=n;this.sources=new Set(o),(this.sourcesPredefined=!!o)&&o.forEach(r=>r.targets.add(this))}sources;sourcesPredefined=!1;dirty=!0;tarnish(){this.dirty||(this.dirty=!0,this.watchers.size?this.recalculate():this.tarnishTargets())}get(){return this.dirty&&this.recalculate(),super.get()}recalculate(){if(this.sourcesPredefined)return this.update();if(ne)throw new oe("Tried to compute a ref while another one is already being computed \u2014 did you nest a computed ref in another ref's getter function?");this.sources.forEach(n=>n.targets.delete(this)),this.sources.clear();try{ne=n=>{this.sources.add(n),n.targets.add(this)},this.update()}finally{ne=void 0}}update=()=>{this._set(this.getter()),this.dirty=!1}};function ut(e,t){return U(new O(e),n=>t?n.setter(t):n)}var W=class extends O{constructor(n,o){super(()=>o(n.value),[n]);this.source=n}},re=class extends b{set(t){this._set(t)}set value(t){this.set(t)}get value(){return this.get()}bridge(t,n){return this.map(t).setter(o=>this.set(n(o)))}clone(){return new we(this)}},we=class extends W{constructor(n){super(n,Ee);this.source=n}},ve=class extends re{constructor(n,o,r=!1){super(n.value);this.source=n;this.allowMismatch=r;super.watch(ke(this))}set(n){if(super.set(n),!this.allowMismatch&&this.value!==n)throw new oe("Setter did not update the value. If you want to allow this, set the allowMismatch property to true.")}};function ke(e){return t=>{e.set(t)}}function Re(e){return e instanceof b?e.value:e}function He(e){return e instanceof b?e:new b(e)}var P=!0,ae=new Set,V=new Set,G=new Map;async function pt(){let e=await ie("ForceGraph","https://unpkg.com/force-graph"),t,n,o=h(!1).named("minimized"),r=o.map(a=>a?"10":"70");document.body.appendChild(t=T({style:"position: fixed; top: 0; right: 0; z-index: 300; background: #eee; padding: 1em;"},[T({style:"position: relative;"},[n=T({style:r.map(a=>`height: ${a}vh; width: ${a}vw; overflow: auto`)}),I({style:"position: absolute; top: 0; left: 0; color: black",onclick:()=>t.remove()},["X"]),I({style:"position: absolute; top: 0; right: 0; color: black",onclick:()=>o.set(!o.value)},[B(o,"\u2199","\u2197")])])]));let i=[...ae],l=i.map(a=>({id:a.id,ref:a,class:a.constructor.name,name:`${a.name??a.id} (${a.constructor.name}) = ${Array.isArray(a.value)?`${a.value.length} \u2715 ${a.value[0]?.constructor.name}`:a.value?.toString()}`,val:3})),d=l.map(({id:a,ref:{targets:f}})=>[...f].map(({id:p})=>({source:a,target:p}))).flat(),u=i.map(({watchers:a})=>[...a].map(f=>({id:N("watcher-"),watcher:f,class:"watcher",name:`${f.toString()}`}))).flat(),g=new Map(u.map(({watcher:a,id:f})=>[a,f])),y=i.map(({id:a,watchers:f})=>[...f].map(p=>({source:a,target:g.get(p)??x(`Watcher ${p} has no ID.`)})).flat()).flat();function w(a){return{id:N("el-"),element:a,class:a.constructor.name,name:`${a.tagName}#${a.id||""}.${a.className}`,val:a.querySelectorAll("*").length}}let k=[...V].map(w),A=new Map,R=a=>{let f=(k.find(({element:p})=>p===a)??(()=>{let p=w(a);return k.push(p),p})()).id;return M(A,a,f)},H=[...[...G].map(([{id:a},f])=>[...f].map(p=>({source:a,target:R(p)}))).flat(),...[...V].map(a=>[...a.children].filter(p=>p instanceof HTMLElement).map(p=>({source:R(a),target:R(p)}))).flat()],z=[...l,...k,...u],S=[...d,...H,...y],ue={nodes:z,links:S},q=a=>"#"+(a*1234567%Math.pow(2,24)).toString(16).padStart(6,"0"),pe=0,J=new Map,fe=a=>q(M(J,a,++pe));new e(n).graphData(ue).onNodeClick(({ref:a,element:f,watcher:p})=>{console.log(...a?[a._value,a]:[f??p]),D(window,{$:a??f??p})}).nodeAutoColorBy("class").nodeCanvasObjectMode(({ref:a,element:f})=>a?"after":f&&"replace").nodeCanvasObject(({ref:a,element:f,x:p,y:K,val:Te},v)=>{a?.name&&p&&K&&(v.font="10px Arial",v.fillText(a.name,p+10,K)),f&&p&&K&&(v.beginPath(),v.arc(p,K,Math.sqrt(Number(Te)+1),0,2*Math.PI,!1),v.fillStyle="white",v.fill(),v.lineWidth=2,v.strokeStyle=fe(f.tagName),v.stroke())}).linkLineDash(({target:a})=>typeof a=="object"&&a.element?[4,2]:null).linkDirectionalParticles(1);let j={refNodes:l,elementNodes:k,refLinks:d,watcherLinks:y,elementLinks:H};D(window.smork,j),console.log(j)}Object.assign(window,{smork:{devTools:pt,allRefs:ae,allElements:V,refToElementLinks:G}});var ze=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function Se(e){function t(o,r){let[i,l]=Array.isArray(o)?[void 0,o]:[o,r];return n(i,l)}return t;function n(o,r){let i=document.createElement(e);return P&&V.add(i),o&&Ke(o,(l,d)=>{typeof l=="function"?i[d]=l:U(l,u=>{g(Re(u)),He(u).watch(g),P&&u instanceof b&&M(G,u,new Set).add(i);function g(y){typeof y=="boolean"?y?i.setAttribute(d,""):i.removeAttribute(d):i.setAttribute(d,String(y))}})}),r&&r.forEach(l=>{let d=C(),u=g=>{let y=typeof g=="string"?document.createTextNode(g):g instanceof HTMLElement?g:document.createComment("");d?d.replaceWith(y):i.appendChild(y),d=y};l instanceof b?l.watchImmediate(u):u(l),P&&l instanceof b&&M(G,l,new Set).add(i)}),i}}var{a:qe,abbr:vn,address:kn,area:Rn,article:Sn,aside:Cn,audio:Je,b:An,base:Ln,bdi:In,bdo:Nn,blockquote:Kn,body:En,br:Un,button:I,canvas:Dn,caption:Mn,cite:Pn,code:Bn,col:jn,colgroup:Fn,data:$n,datalist:_n,dd:On,del:Wn,details:Vn,dfn:Gn,dialog:Hn,div:T,dl:zn,dt:qn,em:Jn,embed:Yn,fieldset:Xn,figcaption:Qn,figure:Zn,footer:eo,form:to,h1:no,h2:oo,h3:Ye,h4:ro,h5:ao,h6:io,head:so,header:lo,hgroup:co,hr:uo,html:po,i:fo,iframe:To,img:Xe,input:mo,ins:yo,kbd:go,label:ft,legend:ho,li:xo,link:bo,main:wo,map:vo,mark:ko,menu:Ro,meta:So,meter:Co,nav:Ao,noscript:Lo,object:Io,ol:No,optgroup:Ko,option:Eo,output:Uo,p:Qe,picture:Do,pre:Mo,progress:Po,q:Bo,rp:jo,rt:Fo,ruby:$o,s:_o,samp:Oo,script:Tt,search:Wo,section:Vo,select:Go,slot:Ho,small:zo,source:qo,span:Jo,strong:Yo,style:Ze,sub:Xo,summary:Qo,sup:Zo,table:er,tbody:tr,td:nr,template:or,textarea:rr,tfoot:ar,th:ir,thead:sr,time:lr,title:cr,tr:dr,track:ur,u:pr,ul:fr,var:Tr,video:mr,wbr:yr}=ze.reduce((e,t)=>(e[t]=Se(t),e),{});function se(e,t){return Se("input")({...t,type:"checkbox",checked:e,onchange:()=>e.set(!e.value)})}function et(e,t){return Se("input")({...t,type:"text",value:e,onkeyup:({key:n,target:o})=>{n==="Enter"&&o instanceof HTMLInputElement&&e.set(o.value)}})}function le(e,t){t.id||=N("smork-input-");let n=[ft({for:t.id},[e]),t];return t.type==="checkbox"&&n.reverse(),n}async function ie(e,t){return window[e]?window[e]:new Promise(n=>{document.head.appendChild(Tt({src:t,onload:()=>n(window[e])}))})}function B(e,t,n=C()){return e.map(o=>o?F(t,o):F(n))}function Ce({id:e,image_url:t,name:n,tags:o}){return T({class:"relative"},[qe({href:`https://suno.com/song/${e}`,target:"_blank"},[Xe({src:t,style:"opacity: 0.5; width: 200px"}),T({class:"absolute topleft",style:"width: 190px; padding: 5px"},[T([n||"[Untitled]"]),T({class:"smol"},[o||"(no style)"])])])])}var tt='.colony { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;}.colony button {background-color: #444;color: #eee}.colony #sidebar {position: fixed;padding: 10px;top: 0;left: 0;bottom: 0;width: 200px;background-color: #333;color: #eee;display: flex;flex-direction: column;justify-content: space-between;}.colony .f-row {display: flex;flex-direction: row;}.colony .f-col {display: flex;flex-direction: column;}.colony .smol {font-size: 0.8em;color: #aaa;}.colony .relative {position: relative;}.colony .absolute {position: absolute;}.colony .topleft {top: 0;left: 0;}.colony .p-1 {padding: 1rem;};.colony .p-2 {padding: 2rem;}.colony .w-100 {width: 100%;}.colony .h-100 {height: 100%;}.colony .j-between {justify-content: space-between;}.colony .settings > * {margin-top: 5px;}';async function Ae(e,t,{mode:n=C()}){let o=Q(t);let r=n?.toLowerCase()==="3d",i=h(!1).named("hideUI"),l=i.map(s=>!s).named("showUI"),d=h(!0).named("useNextLinks"),u=h(!0).named("useDescendantLinks"),g=h("").named("filterString"),y=h(!1).named("showNextLinks"),w=h().named("audioElement"),k=h().named("selectedClip");k.watch(()=>setTimeout(()=>{w()?.play()},0));let A=new Map;function R(s){return A.get(s)??Fe(o?.nodes.find(c=>c.id===s)??x(`Node with ID ${s} not found.`),c=>A.set(s,c))}let H=await ie("ForceGraph",`https://unpkg.com/${r?"3d-":""}force-graph`);window.document.head.appendChild(Ze([tt]));let z=T(),S=new H(z).graphData(o).backgroundColor("#001").linkAutoColorBy("kind").nodeAutoColorBy("rootId").linkLabel("kind").linkDirectionalParticles(1).nodeLabel(s=>T([Ce(s),T({class:"smol"},["Click to play, right-click to open in Suno"])]).outerHTML).onNodeClick(ke(k)).onNodeRightClick(({id:s})=>{window.open(`https://suno.com/song/${s}`)});r?S.linkOpacity(s=>s.isMain?1:.2):S.linkLineDash(s=>s.isMain?null:[1,2]),Object.assign(window,{graph:S});async function ue(){new FinalizationRegistry(()=>console.log("Previous graph destroyed, container removed from memory")).register(S,""),S._destructor(),v.remove(),await Ae(this,t,{mode:n})}y.watchImmediate(s=>{S.linkVisibility(c=>!{descendant:!0,next:!s}[c.kind])});function q(s){return typeof s=="string"?s:s.id}function pe(s,c){return q(s)===q(c)}function J(s){return c=>pe(s,c)}let fe=h(Date.now).named("graphLastUpdated"),j=g.map(s=>{let{nodes:c}=o;return s?(s=s.toLowerCase(),c.filter(m=>`${m.id} ${m.name} ${m.tags} ${m.created_at}`.toLowerCase().includes(s))):c}).named("matchingNodes");j.watchImmediate(s=>S.nodeVal(c=>s.some(m=>m.id===c.id)?3:c.val));let a=h({filter:g,nodes:j}).map(({filter:s,nodes:c})=>s?[...c,...o.nodes?.filter(m=>!c.includes(m)&&c.some(E=>E.rootId===m.rootId))??[]]:c).named("nodes"),f=a.map(s=>s?o.links.filter(c=>s.some(J(c.source))&&s.some(J(c.target))):[]).named("linksBetweenFilteredNodes"),p=h({nodes:a,useNextLinks:d}).map(({nodes:s,useNextLinks:c})=>!s||!c?[]:($(s),s.filter(m=>m.rootId===m.id).slice(1).map((m,E)=>({source:s[E].id,target:m.id,kind:"next",color:"#006",isMain:!1})))).named("nextLinks"),K=h({nodes:a,useDescendantLinks:u}).map(({nodes:s,useDescendantLinks:c})=>!s||!c?[]:De(s.map(m=>{let E=R(m.rootId??x(`Node ${m.id} has no root ID.`));return E!==m?{source:E.id,target:m.id,kind:"descendant",isMain:!1}:null}))).named("descendantLinks"),Te=h({linksBetweenFilteredNodes:f,nextLinks:p,descendantLinks:K}).map(({linksBetweenFilteredNodes:s,nextLinks:c,descendantLinks:m})=>[...s,...c,...m]).named("links");h({nodes:a,links:Te}).named("graphData").watchImmediate(s=>{S.graphData(s),fe.update()}),setTimeout(()=>{d(!1),u(!1)},2e3);let v=document.body.appendChild(T({class:"colony",style:"position: fixed; top: 0px; left: 0px; z-index: 100;"},[B(l,T({style:"flex-direction: column; height: 100vh; width: 100vh; background-color: #000;"},[z,T({id:"sidebar"},[T({class:"settings f-col"},[I({style:"margin-bottom: 5px;",onclick:()=>i(!0)},["Close Colony"]),Ye(["Settings"]),T(le("Attract based on time",se(d))),B(d,T(le("Show time-based links",se(y)))),T(le("Attract to root clip",se(u))),T([et(g,{placeholder:"Filter by name, style or ID"}),Qe({class:"smol"},["Enter to apply. (Filter will include both matching nodes and any nodes belonging to the same root clip.)"])]),I({onclick:ue},["Redraw"]),I({onclick:()=>e.renderToFile(n)},["Download"])]),B(k,s=>T({class:"w-100"},[Ce(s),w(Je({src:s.audio_url,controls:!0,class:"w-100"}))]))])]),I({style:"position: fixed; top: 0px; left: 0px; padding: 5px; z-index: 100;",onclick:()=>i(!1)},["Reopen Colony"]))]))}var mt="https://studio-api.prod.suno.com/api/";function nt(e,t){return async(...n)=>{let o=e(...n),r=await fetch(mt+o,{headers:{authorization:`Bearer ${await window.Clerk.session.getToken()}`}});if(r.status===404&&t){console.warn(`Could not find resource at ${o}, returning undefined`);return}return await r.json()}}var Le={getClips:nt(e=>"feed/v2?is_liked=true&page="+e),getClip:nt(e=>"clip/"+e,!0)};var yt=["next","descendant"];var Ie={rawClips:ye(),lastProcessedPage:-1,allPagesProcessed:!1,links:ye(),allLinksBuilt:!1},de=class{constructor(t=Ie){this.state=t;this.loadState()}reset(){this.state=Ie,console.log("Colony reset. Run build() to start building it again.")}storage=new ee("colony",Ie);stateLoaded=new Z;async loadState(t=!1){if(t){let n=await je();if(!n){console.log("No file selected, aborting.");return}this.state=JSON.parse(n)}else this.state=await this.storage.load();this.stateLoaded.resolve()}async saveState(t=!1){if(t){let n=JSON.stringify(this.state),o=new Blob([n],{type:"application/json"}),r=URL.createObjectURL(o),i=document.createElement("a");i.href=r,i.download="suno_colony.json",i.click(),URL.revokeObjectURL(r)}else await this.storage.save(this.state)}async build(){try{this.state.allPagesProcessed||await this.fetchClips(),this.state.allLinksBuilt||await this.buildLinks()}finally{await this.saveState()}}async fetchClips(){for(console.log("Fetching liked clips...");;){await ge(1e3);let{clips:t}=await Le.getClips(this.state.lastProcessedPage+1);if(!t.length){this.state.allPagesProcessed=!0;break}this.state.rawClips.push(...t),this.state.lastProcessedPage++,console.log(`Processed page ${this.state.lastProcessedPage}; total clips: ${this.state.rawClips.length}`)}}rawClipsById={};async loadClip(t){await ge(1e3);console.log(`Clip ${t} not found in cache, loading...`);let n=await Le.getClip(t)??ht(t);return this.state.rawClips.push(n),n}getClipByIdSync(t){return this.rawClipsById[t]??=this.state.rawClips.find(n=>gt(t)?n.audio_url.includes(t):n.id===t)}async getClipById(t){return t.startsWith("m_")&&(t=t.slice(2)),this.getClipByIdSync(t)??await this.loadClip(t)}async buildLinks(){console.log("Building links...");for(let t=0;t<this.state.rawClips.length;t++){let n=this.state.rawClips[t];t%100===0&&console.log(`Processed ${t} clips out of ${this.state.rawClips.length}`);let{metadata:o}=n,[r,i]="history"in o?U(o.history[0],l=>typeof l=="string"?[l,"extend"]:l.infill?[l.id,"inpaint"]:[l.id,"extend"]):"concat_history"in o?[o.concat_history[1].id,"apply"]:"cover_clip_id"in o?[o.cover_clip_id,"cover"]:"upsample_clip_id"in o?[o.upsample_clip_id,"remaster"]:"type"in o&&o.type==="edit_crop"?await Oe(n,this.state.rawClips).then(l=>l?[l,"crop"]:[void 0,void 0]):[void 0,void 0];r&&this.state.links.push([(await this.getClipById(r)).id,n.id,i])}this.state.allLinksBuilt=!0,console.log(`Built ${this.state.links.length} links.`),console.log("Colony built. Run `await vovas.colony.render()` to view it!")}_linkedClips;get linkedClips(){return this._linkedClips??=this.getLinkedClips()}getLinkedClips(){let t=this.state.links.reduce((o,[r,i,l])=>{let d=Y(o,{id:r})??x(`Could not find parent for link ${r} -> ${i}.`),u=Y(o,{id:i})??x(`Could not find child for link ${r} -> ${i}.`);if(u.parent)throw new Error(`Child ${i} already has a parent: ${u.parent.clip.id}`);return u.parent={kind:l,clip:d},(d.children??=[]).push({kind:l,clip:u}),o},Q(this.state.rawClips));for(let o of t.filter(({parent:r})=>!r))n(o,o);return t;function n(o,r){Object.assign(o,{root:r});for(let{clip:i}of o.children??[])n(i,r)}}_rootClips;get rootClips(){return this._rootClips??=this.getRootClips()}getRootClips(){let t=this.linkedClips.filter(({parent:n})=>!n);return $(t)}get sortedClips(){let t=[],{rootClips:n}=this;for(let r of n)o(r);return t.reverse();function o(r){t.push(r);let{children:i}=r;if(i)for(let{clip:l}of $(i,({clip:d})=>d.created_at))o(l)}}get syntheticLinks(){let t=[];return t}getTotalDescendants(t){let n=Y(this.linkedClips,{id:t})??x(`Clip ${t} not found.`);return n.totalDescendants??=1+(n.children?.reduce((o,{clip:{id:r}})=>o+this.getTotalDescendants(r),0)??0)}_graphData=C();getGraphData(){let t=this.sortedClips.map(({id:r,title:i,metadata:{tags:l},created_at:d,children:u,audio_url:g,image_url:y,root:w})=>({id:r,name:i||l||d||r,created_at:d,audio_url:g,image_url:y,tags:l,rootId:w?.id,val:r===w?.id&&u?.length?2:u?.length?1:.5})),n=([r,i,l])=>({source:r,target:i,kind:l,color:l==="next"?"#006":void 0,isMain:!yt.includes(l)&&this.getTotalDescendants(i)>1});return{nodes:t,links:[...this.syntheticLinks,...this.state.links].map(n)}}get graphData(){return this._graphData??=this.getGraphData()}getHtml(t){return console.log("Rendering your colony, give it a few seconds..."),`<script>(vovas = {${window.vovas.main.toString()}}).main();vovas.colony.render(...${JSON.stringify([t,this.graphData])})<\/script>`}async render(t,n){console.log("Rendering your colony, give it a few seconds..."),this._graphData??=n,await Ae(this,this.graphData,{mode:t})}renderToFile(...t){let n=this.getHtml(...t),o=new Blob([n],{type:"text/html"}),r=URL.createObjectURL(o),i=document.createElement("a");i.href=r,i.download="suno_colony.html",i.click(),URL.revokeObjectURL(r)}},ce=new de;ce.stateLoaded.promise.then(async()=>{console.log("Welcome to Vova\u2019s Suno Colony! This is a nifty tool to visualize your liked clips and the relationships between them, such as extensions, inpaints, covers, etc., in a graph format. It takes a bit of time and hacks to build, but hopefully it\u2019ll be worth it!");let{state:{allPagesProcessed:e,allLinksBuilt:t}}=ce;!e||!t?console.log("Run `await vovas.colony.build()` to start or continue building your colony!"):(console.log("Your colony is built, rendering!"),await ce.render())});function gt(e){return e.match(/_\d+$/)}function ht(e){return console.warn(`Clip ${e} not found, creating a missing clip.`),{isMissing:!0,id:e,title:"*Clip not found*",created_at:null,audio_url:`https://cdn1.suno.ai/${e}.mp3`,image_url:"",metadata:{duration:0,tags:""}}}D(window.vovas,{Colony:de,colony:ce,debug:he});he();})();
}}).main();

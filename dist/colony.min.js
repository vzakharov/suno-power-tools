(vovas = { main() {
(()=>{function V(t,e){return t.find(Xe(e))}function Xe(t){return function(e){return Object.entries(t).every(([n,o])=>e[n]===o)}}var Le={};function S(t=""){return Le[t]??=0,`${t}${++Le[t]}`}function q(t,e){return Object.fromEntries(Object.entries(t).map(([n,o])=>[n,e(o,n)]))}function Se(t,e){return q(t,e)}function pe(t){return typeof t=="function"}function Ae(t){return t}function Ie(t,e){return Object.assign(t,e)}function Ee(t){return t.filter(Boolean)}function ue(t){return Object.values(t)}function fe(){return[]}function E(t,e){return e(t)}function Y(t){return JSON.parse(JSON.stringify(t))}function U(t,e){Object.assign(t,e)}function Pe(t,e){return U(t,e),t}var Ue=0;function me(t){let e=Math.max(0,t-(Date.now()-Ue));return new Promise(n=>{setTimeout(()=>{Ue=Date.now(),n()},e)})}function k(t){throw new Error(t)}async function Ke(){let t=document.createElement("input");return t.type="file",t.click(),new Promise(e=>{t.onchange=()=>{let n=t.files?.[0];if(!n)return e(void 0);let o=new FileReader;o.onload=()=>{e(o.result),t.remove()},o.readAsText(n)}})}function De(t){return t?new Date(t).getTime():0}function F(t,e=n=>n.created_at){return t.sort((n,o)=>De(e(n))-De(e(o)))}function ge(t){if(typeof t=="function")return function(...e){debugger;return t(...e)};debugger;return t}function _e(t,e){return e(t),t}function D(t,e,n){let o=t.get(e);return o!==void 0?o:(t.set(e,n),n)}async function $e(t,e){for(let n of e.slice(e.findIndex(o=>o.id===t.id)+1))if(n!==t&&n.metadata.tags===t.metadata.tags&&await Qe(n.image_url,t.image_url))return console.warn(`Found potential base clip for cropped clip ${t.id}: ${n.id} (this is not guaranteed to be correct)`),n.id;console.warn(`Could not find a base clip for cropped clip ${t.id}, the clip will be mistakenly marked as a root clip.`)}async function Fe(t){let n=await(await fetch(t)).blob();return new Promise((o,i)=>{let a=new Image;a.onload=()=>{URL.revokeObjectURL(a.src),o(a)},a.onerror=i,a.src=URL.createObjectURL(n)})}async function Qe(t,e){let n=await Fe(t),o=await Fe(e),i=document.createElement("canvas");i.width=n.width,i.height=n.height;let a=i.getContext("2d")??k("Canvas 2D context not supported");a.drawImage(n,0,0);let l=a.getImageData(0,0,n.width,n.height);a.drawImage(o,0,0);let d=a.getImageData(0,0,o.width,o.height),p=l.data,y=d.data,h=p.length,x=0;for(let N=0;N<h;N+=4)for(let R=0;R<3;R++)x+=Math.abs(p[N+R]-y[N+R]);let v=x/(h/4);return i.remove(),v<32;}var J=class{resolve;reject;promise;constructor(){this.promise=new Promise((e,n)=>Object.assign(this,{resolve:e,reject:n}))}};var Ze="vovas",$="sunoTools",et=new Promise((t,e)=>{let n=indexedDB.open(Ze,1);n.onupgradeneeded=()=>n.result.createObjectStore($),n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)});async function he(t){return(await et).transaction($,t)}function Me(t){return new Promise((e,n)=>{t.oncomplete=()=>e(),t.onerror=()=>n(t.error)})}async function tt(t){return(await he(t)).objectStore($)}var X=class{constructor(e,n){this.key=e;this.init=n}async load(){let e=(await tt("readonly")).get(this.key);return new Promise((n,o)=>{e.onsuccess=()=>n(e.result??this.init),e.onerror=()=>o(e.error)})}async save(e){let n=await he("readwrite");return n.objectStore($).put(e,this.key),Me(n)}async clear(){let e=await he("readwrite");return e.objectStore($).delete(this.key),Me(e)}};var Z=class extends Error{constructor(e){super(`smork: ${e}`)}};function nt(t){return t&&typeof t=="object"&&ue(t).every(e=>e instanceof b)}function T(t,e){return pe(t)?rt(t,e):nt(t)?new M(()=>q(t,we),ue(t)):new ee(t)}var ot=Symbol("NotApplicable"),b=class{constructor(e){this._value=e;P&&te.add(this)}watchers=new Set;activeWatchers=new WeakSet;targets=new Set;id=S("ref-");name=void 0;named(e){return Pe(this,{name:e})}get(){return Q?.(this),this._value}_set(e){let{_value:n}=this;if(e!==n){this._value=e,this.tarnishTargets();try{for(let o of this.watchers)this.activeWatchers.has(o)&&console.warn("smork: watcher is already active \u2014 perhaps a circular dependency \u2014 exiting watch to prevent infinite loop"),this.activeWatchers.add(o),o(e,n)}finally{this.activeWatchers=new WeakSet}}}tarnishTargets(){this.targets.forEach(e=>e.tarnish())}watchImmediate(e){e(this.value,ot),this.watch(e)}watch(e){this.watchers.add(e)}unwatch(e){this.watchers.delete(e)}get value(){return this.get()}map(e){let n=new B(this,e);return pe(n.value)?(this.targets.delete(n),n.sources.clear(),(...o)=>new B(this,i=>e(i)(...o))):n}mapDefined(e){return this.map(n=>n!==void 0?e(n):void 0)}uses(e){return Ie(this,q(e,this.map))}setter(e=n=>this._set(n)){return new Te(this,e)}},Q,M=class extends b{constructor(n,o=void 0){super(void 0);this.getter=n;this.sources=new Set(o),(this.sourcesPredefined=!!o)&&o.forEach(i=>i.targets.add(this))}sources;sourcesPredefined=!1;dirty=!0;tarnish(){this.dirty||(this.dirty=!0,this.watchers.size?this.recalculate():this.tarnishTargets())}get(){return this.dirty&&this.recalculate(),super.get()}recalculate(){if(this.sourcesPredefined)return this.update();if(Q)throw new Z("Tried to compute a ref while another one is already being computed \u2014 did you nest a computed ref in another ref's getter function?");this.sources.forEach(n=>n.targets.delete(this)),this.sources.clear();try{Q=n=>{this.sources.add(n),n.targets.add(this)},this.update()}finally{Q=void 0}}update=()=>{this._set(this.getter()),this.dirty=!1}};function rt(t,e){return E(new M(t),n=>e?n.setter(e):n)}var B=class extends M{constructor(n,o){super(()=>o(n.value),[n]);this.source=n}},ee=class extends b{set(e){this._set(e)}set value(e){this.set(e)}get value(){return this.get()}bridge(e,n){return this.map(e).setter(o=>this.set(n(o)))}clone(){return new ye(this)}},ye=class extends B{constructor(n){super(n,Ae);this.source=n}},Te=class extends ee{constructor(n,o,i=!1){super(n.value);this.source=n;this.allowMismatch=i;super.watch(xe(this))}set(n){if(super.set(n),!this.allowMismatch&&this.value!==n)throw new Z("Setter did not update the value. If you want to allow this, set the allowMismatch property to true.")}};function xe(t){return e=>{t.set(e)}}function we(t){return t instanceof b?t.value:t}function Be(t){return t instanceof b?t:new b(t)}var P=!0,te=new Set,O=new Set,j=new Map;async function it(){let t=await ne("ForceGraph","https://unpkg.com/force-graph"),e,n,o=T(!1).named("minimized"),i=o.map(r=>r?"10":"70");document.body.appendChild(e=m({style:"position: fixed; top: 0; right: 0; z-index: 300; background: #eee; padding: 1em;"},[m({style:"position: relative;"},[n=m({style:i.map(r=>`height: ${r}vh; width: ${r}vw; overflow: auto`)}),L({style:"position: absolute; top: 0; left: 0; color: black",onclick:()=>e.remove()},["X"]),L({style:"position: absolute; top: 0; right: 0; color: black",onclick:()=>o.set(!o.value)},[K(o,"\u2199","\u2197")])])]));let a=[...te],l=a.map(r=>({id:r.id,ref:r,class:r.constructor.name,name:`${r.name??r.id} (${r.constructor.name}) = ${Array.isArray(r.value)?`${r.value.length} \u2715 ${r.value[0]?.constructor.name}`:r.value?.toString()}`,val:3})),d=l.map(({id:r,ref:{targets:u}})=>[...u].map(({id:f})=>({source:r,target:f}))).flat(),p=a.map(({watchers:r})=>[...r].map(u=>({id:S("watcher-"),watcher:u,class:"watcher",name:`${u.toString()}`}))).flat(),y=new Map(p.map(({watcher:r,id:u})=>[r,u])),h=a.map(({id:r,watchers:u})=>[...u].map(f=>({source:r,target:y.get(f)??k(`Watcher ${f} has no ID.`)})).flat()).flat();function x(r){return{id:S("el-"),element:r,class:r.constructor.name,name:`${r.tagName}#${r.id||""}.${r.className}`,val:r.querySelectorAll("*").length}}let v=[...O].map(x),N=new Map,R=r=>{let u=(v.find(({element:f})=>f===r)??(()=>{let f=x(r);return v.push(f),f})()).id;return D(N,r,u)},W=[...[...j].map(([{id:r},u])=>[...u].map(f=>({source:r,target:R(f)}))).flat(),...[...O].map(r=>[...r.children].filter(f=>f instanceof HTMLElement).map(f=>({source:R(r),target:R(f)}))).flat()],H=[...l,...v,...p],C=[...d,...W,...h],se={nodes:H,links:C},z=r=>"#"+(r*1234567%Math.pow(2,24)).toString(16).padStart(6,"0"),le=0,G=new Map,ce=r=>z(D(G,r,++le));new t(n).graphData(se).onNodeClick(({ref:r,element:u})=>{console.log(...r?[r,r._value]:[u]),U(window,{$:r??u})}).nodeAutoColorBy("class").nodeCanvasObjectMode(({ref:r,element:u})=>r?"after":u&&"replace").nodeCanvasObject(({ref:r,element:u,x:f,y:A,val:de},w)=>{r?.name&&f&&A&&(w.font="10px Arial",w.fillText(r.name,f+10,A)),u&&f&&A&&(w.beginPath(),w.arc(f,A,Math.sqrt(Number(de)+1),0,2*Math.PI,!1),w.fillStyle="white",w.fill(),w.lineWidth=2,w.strokeStyle=ce(u.tagName),w.stroke())}).linkLineDash(({target:r})=>typeof r=="object"&&r.element?[4,2]:null).linkDirectionalParticles(1);let _={refNodes:l,elementNodes:v,refLinks:d,watcherLinks:h,elementLinks:W};U(window.smork,_),console.log(_)}Object.assign(window,{smork:{devTools:it,allRefs:te,allElements:O,refToElementLinks:j}});var Oe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function ke(t){function e(o,i){let[a,l]=Array.isArray(o)?[void 0,o]:[o,i];return n(a,l)}return e;function n(o,i){let a=document.createElement(t);return P&&O.add(a),o&&Se(o,(l,d)=>{typeof l=="function"?a[d]=l:E(l,p=>{y(we(p)),Be(p).watch(y),P&&p instanceof b&&D(j,p,new Set).add(a);function y(h){typeof h=="boolean"?h?a.setAttribute(d,""):a.removeAttribute(d):a.setAttribute(d,String(h))}})}),i&&i.forEach(l=>{let d=void 0,p=y=>{let h=typeof y=="string"?document.createTextNode(y):y instanceof HTMLElement?y:document.createComment("");d?d.replaceWith(h):a.appendChild(h),d=h};l instanceof b?l.watchImmediate(p):p(l),P&&l instanceof b&&D(j,l,new Set).add(a)}),a}}var{a:je,abbr:en,address:tn,area:nn,article:on,aside:rn,audio:We,b:an,base:sn,bdi:ln,bdo:cn,blockquote:dn,body:pn,br:un,button:L,canvas:fn,caption:mn,cite:gn,code:hn,col:yn,colgroup:Tn,data:bn,datalist:xn,dd:wn,del:kn,details:vn,dfn:Rn,dialog:Cn,div:m,dl:Nn,dt:Ln,em:Sn,embed:An,fieldset:In,figcaption:En,figure:Un,footer:Dn,form:Pn,h1:Kn,h2:_n,h3:He,h4:Fn,h5:$n,h6:Mn,head:Bn,header:On,hgroup:jn,hr:Wn,html:Hn,i:zn,iframe:Gn,img:ze,input:Vn,ins:qn,kbd:Yn,label:at,legend:Jn,li:Xn,link:Qn,main:Zn,map:eo,mark:to,menu:no,meta:oo,meter:ro,nav:io,noscript:ao,object:so,ol:lo,optgroup:co,option:po,output:uo,p:Ge,picture:fo,pre:mo,progress:go,q:ho,rp:yo,rt:To,ruby:bo,s:xo,samp:wo,script:st,search:ko,section:vo,select:Ro,slot:Co,small:No,source:Lo,span:So,strong:Ao,style:Ve,sub:Io,summary:Eo,sup:Uo,table:Do,tbody:Po,td:Ko,template:_o,textarea:Fo,tfoot:$o,th:Mo,thead:Bo,time:Oo,title:jo,tr:Wo,track:Ho,u:zo,ul:Go,var:Vo,video:qo,wbr:Yo}=Oe.reduce((t,e)=>(t[e]=ke(e),t),{});function oe(t,e){return ke("input")({...e,type:"checkbox",checked:t,onchange:()=>t.set(!t.value)})}function qe(t,e){return ke("input")({...e,type:"text",value:t,onkeyup:({key:n,target:o})=>{n==="Enter"&&o instanceof HTMLInputElement&&t.set(o.value)}})}function re(t,e){e.id||=S("smork-input-");let n=[at({for:e.id},[t]),e];return e.type==="checkbox"&&n.reverse(),n}async function ne(t,e){return window[t]?window[t]:new Promise(n=>{document.head.appendChild(st({src:e,onload:()=>n(window[t])}))})}function K(t,e,n=void 0){return t.map(o=>o?e:n)}function ve({id:t,image_url:e,name:n,tags:o}){return m({class:"relative"},[je({href:`https://suno.com/song/${t}`,target:"_blank"},[ze({src:e,style:"opacity: 0.5; width: 200px"}),m({class:"absolute topleft",style:"width: 190px; padding: 5px"},[m([n||"[Untitled]"]),m({class:"smol"},[o||"(no style)"])])])])}var Ye='.colony { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;}.colony button {background-color: #444;color: #eee}.colony #sidebar {position: fixed;padding: 10px;top: 0;left: 0;bottom: 0;width: 200px;background-color: #333;color: #eee;display: flex;flex-direction: column;justify-content: space-between;}.colony .f-row {display: flex;flex-direction: row;}.colony .f-col {display: flex;flex-direction: column;}.colony .smol {font-size: 0.8em;color: #aaa;}.colony .relative {position: relative;}.colony .absolute {position: absolute;}.colony .topleft {top: 0;left: 0;}.colony .p-1 {padding: 1rem;};.colony .p-2 {padding: 2rem;}.colony .w-100 {width: 100%;}.colony .h-100 {height: 100%;}.colony .j-between {justify-content: space-between;}.colony .settings > * {margin-top: 5px;}';async function Re(t,e,{mode:n=void 0}){let o=Y(e);let i=n?.toLowerCase()==="3d",a=T(!1).named("hideUI"),l=a.map(s=>!s).named("showUI"),d=T(!0).named("useNextLinks"),p=T(!0).named("useDescendantLinks"),y=T("").named("filterString"),h=T(!1).named("showNextLinks"),x=T().named("audioElement"),v=T().named("selectedClip");v.watch(()=>setTimeout(()=>{x.value?.play()},0));let N=new Map;function R(s){return N.get(s)??_e(o?.nodes.find(c=>c.id===s)??k(`Node with ID ${s} not found.`),c=>N.set(s,c))}let W=await ne("ForceGraph",`https://unpkg.com/${i?"3d-":""}force-graph`);window.document.head.appendChild(Ve([Ye]));let H=m(),C=new W(H).graphData(o).backgroundColor("#001").linkAutoColorBy("kind").nodeAutoColorBy("rootId").linkLabel("kind").linkDirectionalParticles(1).nodeLabel(s=>m([ve(s),m({class:"smol"},["Click to play, right-click to open in Suno"])]).outerHTML).onNodeClick(xe(v)).onNodeRightClick(({id:s})=>{window.open(`https://suno.com/song/${s}`)});i?C.linkOpacity(s=>s.isMain?1:.2):C.linkLineDash(s=>s.isMain?null:[1,2]),Object.assign(window,{graph:C});async function se(){new FinalizationRegistry(()=>console.log("Previous graph destroyed, container removed from memory")).register(C,""),C._destructor(),w.remove(),await Re(this,e,{mode:n})}h.watchImmediate(s=>{C.linkVisibility(c=>!{descendant:!0,next:!s}[c.kind])});function z(s){return typeof s=="string"?s:s.id}function le(s,c){return z(s)===z(c)}function G(s){return c=>le(s,c)}let ce=T(Date.now).named("graphLastUpdated"),_=y.map(s=>{let{nodes:c}=o;return s?(s=s.toLowerCase(),c.filter(g=>`${g.id} ${g.name} ${g.tags} ${g.created_at}`.toLowerCase().includes(s))):c}).named("matchingNodes");_.watchImmediate(s=>C.nodeVal(c=>s.some(g=>g.id===c.id)?3:c.val));let r=T({filter:y,nodes:_}).map(({filter:s,nodes:c})=>s?[...c,...o.nodes?.filter(g=>!c.includes(g)&&c.some(I=>I.rootId===g.rootId))??[]]:c).named("nodes"),u=r.map(s=>s?o.links.filter(c=>s.some(G(c.source))&&s.some(G(c.target))):[]).named("linksBetweenFilteredNodes"),f=T({nodes:r,useNextLinks:d}).map(({nodes:s,useNextLinks:c})=>!s||!c?[]:(F(s),s.filter(g=>g.rootId===g.id).slice(1).map((g,I)=>({source:s[I].id,target:g.id,kind:"next",color:"#006",isMain:!1})))).named("nextLinks"),A=T({nodes:r,useDescendantLinks:p}).map(({nodes:s,useDescendantLinks:c})=>!s||!c?[]:Ee(s.map(g=>{let I=R(g.rootId??k(`Node ${g.id} has no root ID.`));return I!==g?{source:I.id,target:g.id,kind:"descendant",isMain:!1}:null}))).named("descendantLinks"),de=T({linksBetweenFilteredNodes:u,nextLinks:f,descendantLinks:A}).map(({linksBetweenFilteredNodes:s,nextLinks:c,descendantLinks:g})=>[...s,...c,...g]).named("links");T({nodes:r,links:de}).named("graphData").watchImmediate(s=>{C.graphData(s),ce.update()}),setTimeout(()=>{d.set(!1),p.set(!1)},2e3);let w=document.body.appendChild(m({class:"colony",style:"position: fixed; top: 0px; left: 0px; z-index: 100;"},[K(l,m({style:"flex-direction: column; height: 100vh; width: 100vh; background-color: #000;"},[H,m({id:"sidebar"},[m({class:"settings f-col"},[L({style:"margin-bottom: 5px;",onclick:()=>a.set(!0)},["Close Colony"]),He(["Settings"]),m(re("Attract based on time",oe(d))),K(d,m(re("Show time-based links",oe(h)))),m(re("Attract to root clip",oe(p))),m([qe(y,{placeholder:"Filter by name, style or ID"}),Ge({class:"smol"},["Enter to apply. (Filter will include both matching nodes and any nodes belonging to the same root clip.)"])]),L({onclick:se},["Redraw"]),L({onclick:()=>t.renderToFile(n)},["Download"])]),K(v,s=>m({class:"w-100"},[ve(s),x.value=We({src:s.audio_url,controls:!0,class:"w-100"})]))])]),L({style:"position: fixed; top: 0px; left: 0px; padding: 5px; z-index: 100;",onclick:()=>a.set(!1)},["Reopen Colony"]))]))}var lt="https://studio-api.prod.suno.com/api/";function Je(t,e){return async(...n)=>{let o=t(...n),i=await fetch(lt+o,{headers:{authorization:`Bearer ${await window.Clerk.session.getToken()}`}});if(i.status===404&&e){console.warn(`Could not find resource at ${o}, returning undefined`);return}return await i.json()}}var Ce={getClips:Je(t=>"feed/v2?is_liked=true&page="+t),getClip:Je(t=>"clip/"+t,!0)};var ct=["next","descendant"];var Ne={rawClips:fe(),lastProcessedPage:-1,allPagesProcessed:!1,links:fe(),allLinksBuilt:!1},ae=class{constructor(e=Ne){this.state=e;this.loadState()}reset(){this.state=Ne,console.log("Colony reset. Run build() to start building it again.")}storage=new X("colony",Ne);stateLoaded=new J;async loadState(e=!1){if(e){let n=await Ke();if(!n){console.log("No file selected, aborting.");return}this.state=JSON.parse(n)}else this.state=await this.storage.load();this.stateLoaded.resolve()}async saveState(e=!1){if(e){let n=JSON.stringify(this.state),o=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download="suno_colony.json",a.click(),URL.revokeObjectURL(i)}else await this.storage.save(this.state)}async build(){try{this.state.allPagesProcessed||await this.fetchClips(),this.state.allLinksBuilt||await this.buildLinks()}finally{await this.saveState()}}async fetchClips(){for(console.log("Fetching liked clips...");;){await me(1e3);let{clips:e}=await Ce.getClips(this.state.lastProcessedPage+1);if(!e.length){this.state.allPagesProcessed=!0;break}this.state.rawClips.push(...e),this.state.lastProcessedPage++,console.log(`Processed page ${this.state.lastProcessedPage}; total clips: ${this.state.rawClips.length}`)}}rawClipsById={};async loadClip(e){await me(1e3);console.log(`Clip ${e} not found in cache, loading...`);let n=await Ce.getClip(e)??pt(e);return this.state.rawClips.push(n),n}getClipByIdSync(e){return this.rawClipsById[e]??=this.state.rawClips.find(n=>dt(e)?n.audio_url.includes(e):n.id===e)}async getClipById(e){return e.startsWith("m_")&&(e=e.slice(2)),this.getClipByIdSync(e)??await this.loadClip(e)}async buildLinks(){console.log("Building links...");for(let e=0;e<this.state.rawClips.length;e++){let n=this.state.rawClips[e];e%100===0&&console.log(`Processed ${e} clips out of ${this.state.rawClips.length}`);let{metadata:o}=n,[i,a]="history"in o?E(o.history[0],l=>typeof l=="string"?[l,"extend"]:l.infill?[l.id,"inpaint"]:[l.id,"extend"]):"concat_history"in o?[o.concat_history[1].id,"apply"]:"cover_clip_id"in o?[o.cover_clip_id,"cover"]:"upsample_clip_id"in o?[o.upsample_clip_id,"remaster"]:"type"in o&&o.type==="edit_crop"?await $e(n,this.state.rawClips).then(l=>l?[l,"crop"]:[void 0,void 0]):[void 0,void 0];i&&this.state.links.push([(await this.getClipById(i)).id,n.id,a])}this.state.allLinksBuilt=!0,console.log(`Built ${this.state.links.length} links.`),console.log("Colony built. Run `await vovas.colony.render()` to view it!")}_linkedClips;get linkedClips(){return this._linkedClips??=this.getLinkedClips()}getLinkedClips(){let e=this.state.links.reduce((o,[i,a,l])=>{let d=V(o,{id:i})??k(`Could not find parent for link ${i} -> ${a}.`),p=V(o,{id:a})??k(`Could not find child for link ${i} -> ${a}.`);if(p.parent)throw new Error(`Child ${a} already has a parent: ${p.parent.clip.id}`);return p.parent={kind:l,clip:d},(d.children??=[]).push({kind:l,clip:p}),o},Y(this.state.rawClips));for(let o of e.filter(({parent:i})=>!i))n(o,o);return e;function n(o,i){Object.assign(o,{root:i});for(let{clip:a}of o.children??[])n(a,i)}}_rootClips;get rootClips(){return this._rootClips??=this.getRootClips()}getRootClips(){let e=this.linkedClips.filter(({parent:n})=>!n);return F(e)}get sortedClips(){let e=[],{rootClips:n}=this;for(let i of n)o(i);return e.reverse();function o(i){e.push(i);let{children:a}=i;if(a)for(let{clip:l}of F(a,({clip:d})=>d.created_at))o(l)}}get syntheticLinks(){let e=[];return e}getTotalDescendants(e){let n=V(this.linkedClips,{id:e})??k(`Clip ${e} not found.`);return n.totalDescendants??=1+(n.children?.reduce((o,{clip:{id:i}})=>o+this.getTotalDescendants(i),0)??0)}_graphData=void 0;getGraphData(){let e=this.sortedClips.map(({id:i,title:a,metadata:{tags:l},created_at:d,children:p,audio_url:y,image_url:h,root:x})=>({id:i,name:a||l||d||i,created_at:d,audio_url:y,image_url:h,tags:l,rootId:x?.id,val:i===x?.id&&p?.length?2:p?.length?1:.5})),n=([i,a,l])=>({source:i,target:a,kind:l,color:l==="next"?"#006":void 0,isMain:!ct.includes(l)&&this.getTotalDescendants(a)>1});return{nodes:e,links:[...this.syntheticLinks,...this.state.links].map(n)}}get graphData(){return this._graphData??=this.getGraphData()}getHtml(e){return console.log("Rendering your colony, give it a few seconds..."),`<script>(vovas = {${window.vovas.main.toString()}}).main();vovas.colony.render(...${JSON.stringify([e,this.graphData])})<\/script>`}async render(e,n){console.log("Rendering your colony, give it a few seconds..."),this._graphData??=n,await Re(this,this.graphData,{mode:e})}renderToFile(...e){let n=this.getHtml(...e),o=new Blob([n],{type:"text/html"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download="suno_colony.html",a.click(),URL.revokeObjectURL(i)}},ie=new ae;ie.stateLoaded.promise.then(async()=>{console.log("Welcome to Vova\u2019s Suno Colony! This is a nifty tool to visualize your liked clips and the relationships between them, such as extensions, inpaints, covers, etc., in a graph format. It takes a bit of time and hacks to build, but hopefully it\u2019ll be worth it!");let{state:{allPagesProcessed:t,allLinksBuilt:e}}=ie;!t||!e?console.log("Run `await vovas.colony.build()` to start or continue building your colony!"):(console.log("Your colony is built, rendering!"),await ie.render())});function dt(t){return t.match(/_\d+$/)}function pt(t){return console.warn(`Clip ${t} not found, creating a missing clip.`),{isMissing:!0,id:t,title:"*Clip not found*",created_at:null,audio_url:`https://cdn1.suno.ai/${t}.mp3`,image_url:"",metadata:{duration:0,tags:""}}}U(window.vovas,{Colony:ae,colony:ie,debug:ge});ge();})();
}}).main();

(vovas = { main() {
(()=>{function Y(t,e){return t.find(Ze(e))}function Ze(t){return function(e){return Object.entries(t).every(([n,o])=>e[n]===o)}}var Se={};function I(t=""){return Se[t]??=0,`${t}${++Se[t]}`}function J(t,e){return Object.fromEntries(Object.entries(t).map(([n,o])=>[n,e(o,n)]))}function Ae(t,e){return J(t,e)}function pe(t){return typeof t=="function"}function Ie(t){return t}function Ee(t,e){return Object.assign(t,e)}function De(t){return t.filter(Boolean)}function ue(t){return Object.values(t)}function fe(){return[]}function D(t,e){return e(t)}function X(t){return JSON.parse(JSON.stringify(t))}function U(t,e){Object.assign(t,e)}function Ke(t,e){return U(t,e),t}var Ue=0;function me(t){let e=Math.max(0,t-(Date.now()-Ue));return new Promise(n=>{setTimeout(()=>{Ue=Date.now(),n()},e)})}function v(t){throw new Error(t)}async function _e(){let t=document.createElement("input");return t.type="file",t.click(),new Promise(e=>{t.onchange=()=>{let n=t.files?.[0];if(!n)return e(void 0);let o=new FileReader;o.onload=()=>{e(o.result),t.remove()},o.readAsText(n)}})}function Pe(t){return t?new Date(t).getTime():0}function $(t,e=n=>n.created_at){return t.sort((n,o)=>Pe(e(n))-Pe(e(o)))}function ge(t){if(typeof t=="function")return function(...e){debugger;return t(...e)};debugger;return t}function Fe(t,e){return e(t),t}function P(t,e,n){let o=t.get(e);return o!==void 0?o:(t.set(e,n),n)}async function $e(t,e){for(let n of e.slice(e.findIndex(o=>o.id===t.id)+1))if(n!==t&&n.metadata.tags===t.metadata.tags&&await et(n.image_url,t.image_url))return console.warn(`Found potential base clip for cropped clip ${t.id}: ${n.id} (this is not guaranteed to be correct)`),n.id;console.warn(`Could not find a base clip for cropped clip ${t.id}, the clip will be mistakenly marked as a root clip.`)}async function Me(t){let n=await(await fetch(t)).blob();return new Promise((o,i)=>{let a=new Image;a.onload=()=>{URL.revokeObjectURL(a.src),o(a)},a.onerror=i,a.src=URL.createObjectURL(n)})}async function et(t,e){let n=await Me(t),o=await Me(e),i=document.createElement("canvas");i.width=n.width,i.height=n.height;let a=i.getContext("2d")??v("Canvas 2D context not supported");a.drawImage(n,0,0);let l=a.getImageData(0,0,n.width,n.height);a.drawImage(o,0,0);let p=a.getImageData(0,0,o.width,o.height),f=l.data,b=p.data,T=f.length,w=0;for(let N=0;N<T;N+=4)for(let C=0;C<3;C++)w+=Math.abs(f[N+C]-b[N+C]);let R=w/(T/4);return i.remove(),R<32;}var Q=class{resolve;reject;promise;constructor(){this.promise=new Promise((e,n)=>Object.assign(this,{resolve:e,reject:n}))}};var tt="vovas",B="sunoTools",nt=new Promise((t,e)=>{let n=indexedDB.open(tt,1);n.onupgradeneeded=()=>n.result.createObjectStore(B),n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)});async function he(t){return(await nt).transaction(B,t)}function Be(t){return new Promise((e,n)=>{t.oncomplete=()=>e(),t.onerror=()=>n(t.error)})}async function ot(t){return(await he(t)).objectStore(B)}var Z=class{constructor(e,n){this.key=e;this.init=n}async load(){let e=(await ot("readonly")).get(this.key);return new Promise((n,o)=>{e.onsuccess=()=>n(e.result??this.init),e.onerror=()=>o(e.error)})}async save(e){let n=await he("readwrite");return n.objectStore(B).put(e,this.key),Be(n)}async clear(){let e=await he("readwrite");return e.objectStore(B).delete(this.key),Be(e)}};var te=class extends Error{constructor(e){super(`smork: ${e}`)}};function rt(t){return t&&typeof t=="object"&&ue(t).every(e=>e instanceof x)}function g(t,e){return pe(t)?at(t,e):rt(t)?new O(()=>J(t,we),ue(t)):new ne(t)}var it=Symbol("NotApplicable"),x=class{constructor(e){this._value=e;K&&oe.add(this)}watchers=new Set;activeWatchers=new WeakSet;targets=new Set;id=I("ref-");name=void 0;named(e){return Ke(this,{name:e})}get(){return ee?.(this),this._value}_set(e){let{_value:n}=this;if(e!==n){this._value=e,this.tarnishTargets();try{for(let o of this.watchers)this.activeWatchers.has(o)&&console.warn("smork: watcher is already active \u2014 perhaps a circular dependency \u2014 exiting watch to prevent infinite loop"),this.activeWatchers.add(o),o(e,n)}finally{this.activeWatchers=new WeakSet}}}tarnishTargets(){this.targets.forEach(e=>e.tarnish())}watchImmediate(e){e(this.value,it),this.watch(e)}watch(e){this.watchers.add(e)}unwatch(e){this.watchers.delete(e)}get value(){return this.get()}map(e){let n=new j(this,e);return pe(n.value)?(this.targets.delete(n),n.sources.clear(),(...o)=>new j(this,i=>e(i)(...o))):n}mapDefined(e){return this.map(n=>n!==void 0?e(n):void 0)}uses(e){return Ee(this,J(e,this.map))}setter(e=n=>this._set(n)){return new Te(this,e)}},ee,O=class extends x{constructor(n,o=void 0){super(void 0);this.getter=n;this.sources=new Set(o),(this.sourcesPredefined=!!o)&&o.forEach(i=>i.targets.add(this))}sources;sourcesPredefined=!1;dirty=!0;tarnish(){this.dirty||(this.dirty=!0,this.watchers.size?this.recalculate():this.tarnishTargets())}get(){return this.dirty&&this.recalculate(),super.get()}recalculate(){if(this.sourcesPredefined)return this.update();if(ee)throw new te("Tried to compute a ref while another one is already being computed \u2014 did you nest a computed ref in another ref's getter function?");this.sources.forEach(n=>n.targets.delete(this)),this.sources.clear();try{ee=n=>{this.sources.add(n),n.targets.add(this)},this.update()}finally{ee=void 0}}update=()=>{this._set(this.getter()),this.dirty=!1}};function at(t,e){return D(new O(t),n=>e?n.setter(e):n)}var j=class extends O{constructor(n,o){super(()=>o(n.value),[n]);this.source=n}},ne=class extends x{set(e){this._set(e)}set value(e){this.set(e)}get value(){return this.get()}bridge(e,n){return this.map(e).setter(o=>this.set(n(o)))}clone(){return new ye(this)}},ye=class extends j{constructor(n){super(n,Ie);this.source=n}},Te=class extends ne{constructor(n,o,i=!1){super(n.value);this.source=n;this.allowMismatch=i;super.watch(xe(this))}set(n){if(super.set(n),!this.allowMismatch&&this.value!==n)throw new te("Setter did not update the value. If you want to allow this, set the allowMismatch property to true.")}};function xe(t){return e=>{t.set(e)}}function we(t){return t instanceof x?t.value:t}function Oe(t){return t instanceof x?t:new x(t)}var K=!0,oe=new Set,W=new Set,H=new Map;async function st(){let t=await re("ForceGraph","https://unpkg.com/force-graph"),e,n,o=g(!1).named("minimized"),i=o.map(r=>r?"10":"70");document.body.appendChild(e=h({style:"position: fixed; top: 0; right: 0; z-index: 300; background: #eee; padding: 1em;"},[h({style:"position: relative;"},[n=h({style:i.map(r=>`height: ${r}vh; width: ${r}vw; overflow: auto`)}),S({style:"position: absolute; top: 0; left: 0; color: black",onclick:()=>e.remove()},["X"]),S({style:"position: absolute; top: 0; right: 0; color: black",onclick:()=>o.set(!o.value)},[_(o,"\u2199","\u2197")])])]));let a=[...oe],l=a.map(r=>({id:r.id,ref:r,class:r.constructor.name,name:`${r.name??r.id} (${r.constructor.name}) = ${Array.isArray(r.value)?`${r.value.length} \u2715 ${r.value[0]?.constructor.name}`:r.value?.toString()}`,val:3})),p=l.map(({id:r,ref:{targets:u}})=>[...u].map(({id:m})=>({source:r,target:m}))).flat(),f=a.map(({watchers:r})=>[...r].map(u=>({id:I("watcher-"),watcher:u,class:"watcher",name:`${u.toString()}`}))).flat(),b=new Map(f.map(({watcher:r,id:u})=>[r,u])),T=a.map(({id:r,watchers:u})=>[...u].map(m=>({source:r,target:b.get(m)??v(`Watcher ${m} has no ID.`)})).flat()).flat();function w(r){return{id:I("el-"),element:r,class:r.constructor.name,name:`${r.tagName}#${r.id||""}.${r.className}`,val:r.querySelectorAll("*").length}}let R=[...W].map(w),N=new Map,C=r=>{let u=(R.find(({element:m})=>m===r)??(()=>{let m=w(r);return R.push(m),m})()).id;return P(N,r,u)},z=[...[...H].map(([{id:r},u])=>[...u].map(m=>({source:r,target:C(m)}))).flat(),...[...W].map(r=>[...r.children].filter(m=>m instanceof HTMLElement).map(m=>({source:C(r),target:C(m)}))).flat()],G=[...l,...R,...f],L=[...p,...z,...T],ce={nodes:G,links:L},V=r=>"#"+(r*1234567%Math.pow(2,24)).toString(16).padStart(6,"0"),F=0,M=new Map,q=r=>V(P(M,r,++F));new t(n).graphData(ce).onNodeClick(({ref:r,element:u})=>{console.log(...r?[r,r._value]:[u]),U(window,{$:r??u})}).nodeAutoColorBy("class").nodeCanvasObjectMode(({ref:r,element:u})=>r?"after":u&&"replace").nodeCanvasObject(({ref:r,element:u,x:m,y:E,val:de},k)=>{r?.name&&m&&E&&(k.font="10px Arial",k.fillText(r.name,m+10,E)),u&&m&&E&&(k.beginPath(),k.arc(m,E,Math.sqrt(Number(de)+1),0,2*Math.PI,!1),k.fillStyle="white",k.fill(),k.lineWidth=2,k.strokeStyle=q(u.tagName),k.stroke())}).linkLineDash(({target:r})=>typeof r=="object"&&r.element?[4,2]:null).linkDirectionalParticles(1);let A={refNodes:l,elementNodes:R,refLinks:p,watcherLinks:T,elementLinks:z};U(window.smork,A),console.log(A)}Object.assign(window,{smork:{devTools:st,allRefs:oe,allElements:W,refToElementLinks:H}});var je=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function ke(t){function e(o,i){let[a,l]=Array.isArray(o)?[void 0,o]:[o,i];return n(a,l)}return e;function n(o,i){let a=document.createElement(t);return K&&W.add(a),o&&Ae(o,(l,p)=>{typeof l=="function"?a[p]=l:D(l,f=>{b(we(f)),Oe(f).watch(b),K&&f instanceof x&&P(H,f,new Set).add(a);function b(T){typeof T=="boolean"?T?a.setAttribute(p,""):a.removeAttribute(p):a.setAttribute(p,String(T))}})}),i&&i.forEach(l=>{let p=void 0,f=b=>{let T=typeof b=="string"?document.createTextNode(b):b instanceof HTMLElement?b:document.createComment("");p?p.replaceWith(T):a.appendChild(T),p=T};l instanceof x?l.watchImmediate(f):f(l),K&&l instanceof x&&P(H,l,new Set).add(a)}),a}}var{a:We,abbr:nn,address:on,area:rn,article:an,aside:sn,audio:He,b:ln,base:cn,bdi:dn,bdo:pn,blockquote:un,body:fn,br:mn,button:S,canvas:gn,caption:hn,cite:yn,code:Tn,col:bn,colgroup:xn,data:wn,datalist:kn,dd:vn,del:Rn,details:Cn,dfn:Nn,dialog:Ln,div:h,dl:Sn,dt:An,em:In,embed:En,fieldset:Dn,figcaption:Un,figure:Pn,footer:Kn,form:_n,h1:Fn,h2:Mn,h3:ze,h4:$n,h5:Bn,h6:On,head:jn,header:Wn,hgroup:Hn,hr:zn,html:Gn,i:Vn,iframe:qn,img:Ge,input:Yn,ins:Jn,kbd:Xn,label:lt,legend:Qn,li:Zn,link:eo,main:to,map:no,mark:oo,menu:ro,meta:io,meter:ao,nav:so,noscript:lo,object:co,ol:po,optgroup:uo,option:fo,output:mo,p:Ve,picture:go,pre:ho,progress:yo,q:To,rp:bo,rt:xo,ruby:wo,s:ko,samp:vo,script:ct,search:Ro,section:Co,select:No,slot:Lo,small:So,source:Ao,span:Io,strong:Eo,style:qe,sub:Do,summary:Uo,sup:Po,table:Ko,tbody:_o,td:Fo,template:Mo,textarea:$o,tfoot:Bo,th:Oo,thead:jo,time:Wo,title:Ho,tr:zo,track:Go,u:Vo,ul:qo,var:Yo,video:Jo,wbr:Xo}=je.reduce((t,e)=>(t[e]=ke(e),t),{});function ie(t,e){return ke("input")({...e,type:"checkbox",checked:t,onchange:()=>t.set(!t.value)})}function Ye(t,e){return ke("input")({...e,type:"text",value:t,onkeyup:({key:n,target:o})=>{n==="Enter"&&o instanceof HTMLInputElement&&t.set(o.value)}})}function ae(t,e){e.id||=I("smork-input-");let n=[lt({for:e.id},[t]),e];return e.type==="checkbox"&&n.reverse(),n}async function re(t,e){return window[t]?window[t]:new Promise(n=>{document.head.appendChild(ct({src:e,onload:()=>n(window[t])}))})}function _(t,e,n=void 0){return t.map(o=>o?e:n)}function ve({id:t,image_url:e,name:n,tags:o}){return h({class:"relative"},[We({href:`https://suno.com/song/${t}`,target:"_blank"},[Ge({src:e,style:"opacity: 0.5; width: 200px"}),h({class:"absolute topleft",style:"width: 190px; padding: 5px"},[h([n||"[Untitled]"]),h({class:"smol"},[o||"(no style)"])])])])}var Je='.colony { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;}.colony button {background-color: #444;color: #eee}.colony #sidebar {position: fixed;padding: 10px;top: 0;left: 0;bottom: 0;width: 200px;background-color: #333;color: #eee;display: flex;flex-direction: column;justify-content: space-between;}.colony .f-row {display: flex;flex-direction: row;}.colony .f-col {display: flex;flex-direction: column;}.colony .smol {font-size: 0.8em;color: #aaa;}.colony .relative {position: relative;}.colony .absolute {position: absolute;}.colony .topleft {top: 0;left: 0;}.colony .p-1 {padding: 1rem;};.colony .p-2 {padding: 2rem;}.colony .w-100 {width: 100%;}.colony .h-100 {height: 100%;}.colony .j-between {justify-content: space-between;}.colony .settings > * {margin-top: 5px;}';async function Re(t,e,{mode:n=void 0}){let o=n?.toLowerCase()==="3d",i=g(!1).named("hideUI"),a=i.map(s=>!s).named("showUI"),l=g().named("graphContainer"),p=g(!0).named("useNextLinks"),f=g(!0).named("useDescendantLinks"),b=g("").named("filterString"),T=g(!1).named("showNextLinks"),w=g().named("audioElement"),R=g().named("selectedClip");R.watch(()=>setTimeout(()=>{w.value?.play()},0));let N=new Map;function C(s){return N.get(s)??Fe(A.value?.nodes.find(c=>c.id===s)??v(`Node with ID ${s} not found.`),c=>N.set(s,c))}let z=await re("ForceGraph",`https://unpkg.com/${o?"3d-":""}force-graph`);window.document.head.appendChild(qe([Je]));let G=X(e);let L=l.mapDefined(s=>{let c=new z(s).graphData(G).backgroundColor("#001").linkAutoColorBy("kind").nodeAutoColorBy("rootId").linkLabel("kind").linkDirectionalParticles(1).nodeLabel(d=>h([ve(d),h({class:"smol"},["Click to play, right-click to open in Suno"])]).outerHTML).onNodeClick(xe(R)).onNodeRightClick(({id:d})=>{window.open(`https://suno.com/song/${d}`)});return o?c.linkOpacity(d=>d.isMain?1:.2):c.linkLineDash(d=>d.isMain?null:[1,2]),Object.assign(window,{graph:c}),c}).named("graph");async function ce(){new FinalizationRegistry(()=>console.log("Previous graph destroyed, container removed from memory")).register(L,""),L.value?._destructor(),Qe.remove(),await Re(this,e,{mode:n})}g({graph:L,showNextLinks:T}).named("linkVisibility").watchImmediate(({graph:s,showNextLinks:c})=>{s?.linkVisibility(d=>!{descendant:!0,next:!c}[d.kind])});function V(s){return typeof s=="string"?s:s.id}function F(s,c){return V(s)===V(c)}function M(s){return c=>F(s,c)}let q=g(Date.now).named("graphLastUpdated"),A=g({graph:L,updated:q}).map(({graph:s})=>{let c=G,d=s?.graphData();return d?c&&{nodes:c.nodes.map(y=>d.nodes.find(M(y))??y),links:c.links.map(y=>d.links.find(Le=>F(y.source,Le.source)&&F(y.target,Le.target))??y)}:c}).named("reusableData"),r=g({reusableData:A,filterString:b,graph:L}).map(({reusableData:{nodes:s}={},filterString:c,graph:d})=>!s||!d?[]:c?(c=c.toLowerCase(),s.filter(y=>`${y.id} ${y.name} ${y.tags} ${y.created_at}`.toLowerCase().includes(c))):s).named("matchingNodes");g({graph:L,matchingNodes:r}).named("highlightNodes").watchImmediate(({graph:s,matchingNodes:c})=>s?.nodeVal(d=>c.some(y=>y.id===d.id)?3:d.val));let u=g({matchingNodes:r,reusableData:A}).map(({matchingNodes:s,reusableData:{nodes:c}={}})=>[...s,...c?.filter(d=>s.some(y=>y.rootId===d.rootId&&y.id!==d.id))??[]]).named("nodes"),m=g({reusableData:A,nodes:u}).map(({reusableData:{links:s}={},nodes:c})=>!s||!c?[]:s.filter(d=>c.some(M(d.source))&&c.some(M(d.target)))).named("linksBetweenFilteredNodes"),E=g({nodes:u,useNextLinks:p}).map(({nodes:s,useNextLinks:c})=>!s||!c?[]:($(s),s.slice(1).map((d,y)=>({source:s[y].id,target:d.id,kind:"next",color:"#006",isMain:!1})))).named("nextLinks"),de=g({nodes:u,useDescendantLinks:f}).map(({nodes:s,useDescendantLinks:c})=>!s||!c?[]:De(s.map(d=>{let y=C(d.rootId??v(`Node ${d.id} has no root ID.`));return y!==d?{source:y.id,target:d.id,kind:"descendant",isMain:!1}:null}))).named("descendantLinks"),k=g({linksBetweenFilteredNodes:m,nextLinks:E,descendantLinks:de}).map(({linksBetweenFilteredNodes:s,nextLinks:c,descendantLinks:d})=>[...s,...c,...d]).named("links");g({graph:L,nodes:u,links:k}).named("graphData").watchImmediate(({graph:s,...c})=>{s?.graphData(c),q.update()}),setTimeout(()=>{p.set(!1),f.set(!1)},2e3);let Qe=document.body.appendChild(h({class:"colony",style:"position: fixed; top: 0px; left: 0px; z-index: 100;"},[_(a,h({style:"flex-direction: column; height: 100vh; width: 100vh; background-color: #000;"},[l.value=h(),h({id:"sidebar"},[h({class:"settings f-col"},[S({style:"margin-bottom: 5px;",onclick:()=>i.set(!0)},["Close Colony"]),ze(["Settings"]),h(ae("Attract based on time",ie(p))),_(p,h(ae("Show time-based links",ie(T)))),h(ae("Attract to root clip",ie(f))),h([Ye(b,{placeholder:"Filter by name, style or ID"}),Ve({class:"smol"},["Enter to apply. (Filter will include both matching nodes and any nodes belonging to the same root clip.)"])]),S({onclick:ce},["Redraw"]),S({onclick:()=>t.renderToFile(n)},["Download"])]),_(R,s=>h({class:"w-100"},[ve(s),w.value=He({src:s.audio_url,controls:!0,class:"w-100"})]))])]),S({style:"position: fixed; top: 0px; left: 0px; padding: 5px; z-index: 100;",onclick:()=>i.set(!1)},["Reopen Colony"]))]))}var dt="https://studio-api.prod.suno.com/api/";function Xe(t,e){return async(...n)=>{let o=t(...n),i=await fetch(dt+o,{headers:{authorization:`Bearer ${await window.Clerk.session.getToken()}`}});if(i.status===404&&e){console.warn(`Could not find resource at ${o}, returning undefined`);return}return await i.json()}}var Ce={getClips:Xe(t=>"feed/v2?is_liked=true&page="+t),getClip:Xe(t=>"clip/"+t,!0)};var pt=["next","descendant"];var Ne={rawClips:fe(),lastProcessedPage:-1,allPagesProcessed:!1,links:fe(),allLinksBuilt:!1},le=class{constructor(e=Ne){this.state=e;this.loadState()}reset(){this.state=Ne,console.log("Colony reset. Run build() to start building it again.")}storage=new Z("colony",Ne);stateLoaded=new Q;async loadState(e=!1){if(e){let n=await _e();if(!n){console.log("No file selected, aborting.");return}this.state=JSON.parse(n)}else this.state=await this.storage.load();this.stateLoaded.resolve()}async saveState(e=!1){if(e){let n=JSON.stringify(this.state),o=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download="suno_colony.json",a.click(),URL.revokeObjectURL(i)}else await this.storage.save(this.state)}async build(){try{this.state.allPagesProcessed||await this.fetchClips(),this.state.allLinksBuilt||await this.buildLinks()}finally{await this.saveState()}}async fetchClips(){for(console.log("Fetching liked clips...");;){await me(1e3);let{clips:e}=await Ce.getClips(this.state.lastProcessedPage+1);if(!e.length){this.state.allPagesProcessed=!0;break}this.state.rawClips.push(...e),this.state.lastProcessedPage++,console.log(`Processed page ${this.state.lastProcessedPage}; total clips: ${this.state.rawClips.length}`)}}rawClipsById={};async loadClip(e){await me(1e3);console.log(`Clip ${e} not found in cache, loading...`);let n=await Ce.getClip(e)??ft(e);return this.state.rawClips.push(n),n}getClipByIdSync(e){return this.rawClipsById[e]??=this.state.rawClips.find(n=>ut(e)?n.audio_url.includes(e):n.id===e)}async getClipById(e){return e.startsWith("m_")&&(e=e.slice(2)),this.getClipByIdSync(e)??await this.loadClip(e)}async buildLinks(){console.log("Building links...");for(let e=0;e<this.state.rawClips.length;e++){let n=this.state.rawClips[e];e%100===0&&console.log(`Processed ${e} clips out of ${this.state.rawClips.length}`);let{metadata:o}=n,[i,a]="history"in o?D(o.history[0],l=>typeof l=="string"?[l,"extend"]:l.infill?[l.id,"inpaint"]:[l.id,"extend"]):"concat_history"in o?[o.concat_history[1].id,"apply"]:"cover_clip_id"in o?[o.cover_clip_id,"cover"]:"upsample_clip_id"in o?[o.upsample_clip_id,"remaster"]:"type"in o&&o.type==="edit_crop"?await $e(n,this.state.rawClips).then(l=>l?[l,"crop"]:[void 0,void 0]):[void 0,void 0];i&&this.state.links.push([(await this.getClipById(i)).id,n.id,a])}this.state.allLinksBuilt=!0,console.log(`Built ${this.state.links.length} links.`),console.log("Colony built. Run `await vovas.colony.render()` to view it!")}_linkedClips;get linkedClips(){return this._linkedClips??=this.getLinkedClips()}getLinkedClips(){let e=this.state.links.reduce((o,[i,a,l])=>{let p=Y(o,{id:i})??v(`Could not find parent for link ${i} -> ${a}.`),f=Y(o,{id:a})??v(`Could not find child for link ${i} -> ${a}.`);if(f.parent)throw new Error(`Child ${a} already has a parent: ${f.parent.clip.id}`);return f.parent={kind:l,clip:p},(p.children??=[]).push({kind:l,clip:f}),o},X(this.state.rawClips));for(let o of e.filter(({parent:i})=>!i))n(o,o);return e;function n(o,i){Object.assign(o,{root:i});for(let{clip:a}of o.children??[])n(a,i)}}_rootClips;get rootClips(){return this._rootClips??=this.getRootClips()}getRootClips(){let e=this.linkedClips.filter(({parent:n})=>!n);return $(e)}get sortedClips(){let e=[],{rootClips:n}=this;for(let i of n)o(i);return e.reverse();function o(i){e.push(i);let{children:a}=i;if(a)for(let{clip:l}of $(a,({clip:p})=>p.created_at))o(l)}}get syntheticLinks(){let e=[];return e}getTotalDescendants(e){let n=Y(this.linkedClips,{id:e})??v(`Clip ${e} not found.`);return n.totalDescendants??=1+(n.children?.reduce((o,{clip:{id:i}})=>o+this.getTotalDescendants(i),0)??0)}_graphData=void 0;getGraphData(){let e=this.sortedClips.map(({id:i,title:a,metadata:{tags:l},created_at:p,children:f,audio_url:b,image_url:T,root:w})=>({id:i,name:a||l||p||i,created_at:p,audio_url:b,image_url:T,tags:l,rootId:w?.id,val:i===w?.id&&f?.length?2:f?.length?1:.5})),n=([i,a,l])=>({source:i,target:a,kind:l,color:l==="next"?"#006":void 0,isMain:!pt.includes(l)&&this.getTotalDescendants(a)>1});return{nodes:e,links:[...this.syntheticLinks,...this.state.links].map(n)}}get graphData(){return this._graphData??=this.getGraphData()}getHtml(e){return console.log("Rendering your colony, give it a few seconds..."),`<script>(vovas = {${window.vovas.main.toString()}}).main();vovas.colony.render(...${JSON.stringify([e,this.graphData])})<\/script>`}async render(e,n){console.log("Rendering your colony, give it a few seconds..."),this._graphData??=n,await Re(this,this.graphData,{mode:e})}renderToFile(...e){let n=this.getHtml(...e),o=new Blob([n],{type:"text/html"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download="suno_colony.html",a.click(),URL.revokeObjectURL(i)}},se=new le;se.stateLoaded.promise.then(async()=>{console.log("Welcome to Vova\u2019s Suno Colony! This is a nifty tool to visualize your liked clips and the relationships between them, such as extensions, inpaints, covers, etc., in a graph format. It takes a bit of time and hacks to build, but hopefully it\u2019ll be worth it!");let{state:{allPagesProcessed:t,allLinksBuilt:e}}=se;!t||!e?console.log("Run `await vovas.colony.build()` to start or continue building your colony!"):(console.log("Your colony is built, rendering!"),await se.render())});function ut(t){return t.match(/_\d+$/)}function ft(t){return console.warn(`Clip ${t} not found, creating a missing clip.`),{isMissing:!0,id:t,title:"*Clip not found*",created_at:null,audio_url:`https://cdn1.suno.ai/${t}.mp3`,image_url:"",metadata:{duration:0,tags:""}}}U(window.vovas,{Colony:le,colony:se,debug:ge});ge();})();
}}).main();

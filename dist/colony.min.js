(vovas = { main() {
(()=>{function V(t,e){return t.find(Qe(e))}function Qe(t){return function(e){return Object.entries(t).every(([n,o])=>e[n]===o)}}var Ae={};function A(t=""){return Ae[t]??=0,`${t}${++Ae[t]}`}function J(t,e){return Object.fromEntries(Object.entries(t).map(([n,o])=>[n,e(o,n)]))}function Ne(t,e){return J(t,e)}function F(t){return typeof t=="function"}function Ie(t){return t}function Ee(t,e){return Object.assign(t,e)}function Ue(t){return t.filter(Boolean)}function ue(t){return Object.values(t)}function fe(){return[]}function E(t,e){return e(t)}function Y(t){return JSON.parse(JSON.stringify(t))}function U(t,e){Object.assign(t,e)}function Pe(t,e){return U(t,e),t}var Ke=0;function me(t){let e=Math.max(0,t-(Date.now()-Ke));return new Promise(n=>{setTimeout(()=>{Ke=Date.now(),n()},e)})}function k(t){throw new Error(t)}async function _e(){let t=document.createElement("input");return t.type="file",t.click(),new Promise(e=>{t.onchange=()=>{let n=t.files?.[0];if(!n)return e(void 0);let o=new FileReader;o.onload=()=>{e(o.result),t.remove()},o.readAsText(n)}})}function De(t){return t?new Date(t).getTime():0}function B(t,e=n=>n.created_at){return t.sort((n,o)=>De(e(n))-De(e(o)))}function ye(t){if(typeof t=="function")return function(...e){debugger;return t(...e)};debugger;return t}function Fe(t,e){return e(t),t}function K(t,e,n){let o=t.get(e);return o!==void 0?o:(t.set(e,n),n)}async function $e(t,e){for(let n of e.slice(e.findIndex(o=>o.id===t.id)+1))if(n!==t&&n.metadata.tags===t.metadata.tags&&await Ze(n.image_url,t.image_url))return console.warn(`Found potential base clip for cropped clip ${t.id}: ${n.id} (this is not guaranteed to be correct)`),n.id;console.warn(`Could not find a base clip for cropped clip ${t.id}, the clip will be mistakenly marked as a root clip.`)}async function Be(t){let n=await(await fetch(t)).blob();return new Promise((o,i)=>{let a=new Image;a.onload=()=>{URL.revokeObjectURL(a.src),o(a)},a.onerror=i,a.src=URL.createObjectURL(n)})}async function Ze(t,e){let n=await Be(t),o=await Be(e),i=document.createElement("canvas");i.width=n.width,i.height=n.height;let a=i.getContext("2d")??k("Canvas 2D context not supported");a.drawImage(n,0,0);let l=a.getImageData(0,0,n.width,n.height);a.drawImage(o,0,0);let d=a.getImageData(0,0,o.width,o.height),p=l.data,g=d.data,T=p.length,x=0;for(let L=0;L<T;L+=4)for(let R=0;R<3;R++)x+=Math.abs(p[L+R]-g[L+R]);let v=x/(T/4);return i.remove(),v<32;}var X=class{resolve;reject;promise;constructor(){this.promise=new Promise((e,n)=>Object.assign(this,{resolve:e,reject:n}))}};var et="vovas",$="sunoTools",tt=new Promise((t,e)=>{let n=indexedDB.open(et,1);n.onupgradeneeded=()=>n.result.createObjectStore($),n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)});async function Te(t){return(await tt).transaction($,t)}function Me(t){return new Promise((e,n)=>{t.oncomplete=()=>e(),t.onerror=()=>n(t.error)})}async function nt(t){return(await Te(t)).objectStore($)}var Q=class{constructor(e,n){this.key=e;this.init=n}async load(){let e=(await nt("readonly")).get(this.key);return new Promise((n,o)=>{e.onsuccess=()=>n(e.result??this.init),e.onerror=()=>o(e.error)})}async save(e){let n=await Te("readwrite");return n.objectStore($).put(e,this.key),Me(n)}async clear(){let e=await Te("readwrite");return e.objectStore($).delete(this.key),Me(e)}};var kt=Symbol("brand");function ge(t,e){return F(t)?t(e):t}var ee=class extends Error{constructor(e){super(`smork: ${e}`)}};function ot(t){return t&&typeof t=="object"&&ue(t).every(e=>e instanceof b)}function h(t,e){return F(t)?it(t,e):ot(t)?new M(()=>J(t,ke),ue(t)):new te(t)}var rt=Symbol("NotApplicable"),b=class{constructor(e){this._value=e;D&&ne.add(this)}watchers=new Set;activeWatchers=new WeakSet;targets=new Set;id=A("ref-");name=void 0;named(e){return Pe(this,{name:e})}get(){return Z?.(this),this._value}_set(e){let{_value:n}=this;if(e!==n){this._value=e,this.tarnishTargets();try{for(let o of this.watchers)this.activeWatchers.has(o)&&console.warn("smork: watcher is already active \u2014 perhaps a circular dependency \u2014 exiting watch to prevent infinite loop"),this.activeWatchers.add(o),o(e,n)}finally{this.activeWatchers=new WeakSet}}}tarnishTargets(){this.targets.forEach(e=>e.tarnish())}watchImmediate(e){e(this.value,rt),this.watch(e)}watch(e){this.watchers.add(e)}unwatch(e){this.watchers.delete(e)}get value(){return this.get()}map(e){let n=new O(this,e);return F(n.value)?(this.targets.delete(n),n.sources.clear(),(...o)=>new O(this,i=>e(i)(...o))):n}mapDefined(e){return this.map(n=>n!==void 0?e(n):void 0)}uses(e){return Ee(this,J(e,this.map))}setter(e=n=>this._set(n)){return new be(this,e)}},Z,M=class extends b{constructor(n,o=void 0){super(void 0);this.getter=n;this.sources=new Set(o),(this.sourcesPredefined=!!o)&&o.forEach(i=>i.targets.add(this))}sources;sourcesPredefined=!1;dirty=!0;tarnish(){this.dirty||(this.dirty=!0,this.watchers.size?this.recalculate():this.tarnishTargets())}get(){return this.dirty&&this.recalculate(),super.get()}recalculate(){if(this.sourcesPredefined)return this.update();if(Z)throw new ee("Tried to compute a ref while another one is already being computed \u2014 did you nest a computed ref in another ref's getter function?");this.sources.forEach(n=>n.targets.delete(this)),this.sources.clear();try{Z=n=>{this.sources.add(n),n.targets.add(this)},this.update()}finally{Z=void 0}}update=()=>{this._set(this.getter()),this.dirty=!1}};function it(t,e){return E(new M(t),n=>e?n.setter(e):n)}var O=class extends M{constructor(n,o){super(()=>o(n.value),[n]);this.source=n}},te=class extends b{set(e){this._set(e)}set value(e){this.set(e)}get value(){return this.get()}bridge(e,n){return this.map(e).setter(o=>this.set(n(o)))}clone(){return new he(this)}},he=class extends O{constructor(n){super(n,Ie);this.source=n}},be=class extends te{constructor(n,o,i=!1){super(n.value);this.source=n;this.allowMismatch=i;super.watch(we(this))}set(n){if(super.set(n),!this.allowMismatch&&this.value!==n)throw new ee("Setter did not update the value. If you want to allow this, set the allowMismatch property to true.")}};function we(t){return e=>{t.set(e)}}function ke(t){return t instanceof b?t.value:t}function Oe(t){return t instanceof b?t:new b(t)}var D=!0,ne=new Set,j=new Set,W=new Map;async function at(){let t=await oe("ForceGraph","https://unpkg.com/force-graph"),e,n,o=h(!1).named("minimized"),i=o.map(r=>r?"10":"70");document.body.appendChild(e=m({style:"position: fixed; top: 0; right: 0; z-index: 300; background: #eee; padding: 1em;"},[m({style:"position: relative;"},[n=m({style:i.map(r=>`height: ${r}vh; width: ${r}vw; overflow: auto`)}),S({style:"position: absolute; top: 0; left: 0; color: black",onclick:()=>e.remove()},["X"]),S({style:"position: absolute; top: 0; right: 0; color: black",onclick:()=>o.set(!o.value)},[P(o,"\u2199","\u2197")])])]));let a=[...ne],l=a.map(r=>({id:r.id,ref:r,class:r.constructor.name,name:`${r.name??r.id} (${r.constructor.name}) = ${Array.isArray(r.value)?`${r.value.length} \u2715 ${r.value[0]?.constructor.name}`:r.value?.toString()}`,val:3})),d=l.map(({id:r,ref:{targets:f}})=>[...f].map(({id:u})=>({source:r,target:u}))).flat(),p=a.map(({watchers:r})=>[...r].map(f=>({id:A("watcher-"),watcher:f,class:"watcher",name:`${f.toString()}`}))).flat(),g=new Map(p.map(({watcher:r,id:f})=>[r,f])),T=a.map(({id:r,watchers:f})=>[...f].map(u=>({source:r,target:g.get(u)??k(`Watcher ${u} has no ID.`)})).flat()).flat();function x(r){return{id:A("el-"),element:r,class:r.constructor.name,name:`${r.tagName}#${r.id||""}.${r.className}`,val:r.querySelectorAll("*").length}}let v=[...j].map(x),L=new Map,R=r=>{let f=(v.find(({element:u})=>u===r)??(()=>{let u=x(r);return v.push(u),u})()).id;return K(L,r,f)},H=[...[...W].map(([{id:r},f])=>[...f].map(u=>({source:r,target:R(u)}))).flat(),...[...j].map(r=>[...r.children].filter(u=>u instanceof HTMLElement).map(u=>({source:R(r),target:R(u)}))).flat()],z=[...l,...v,...p],C=[...d,...H,...T],le={nodes:z,links:C},G=r=>"#"+(r*1234567%Math.pow(2,24)).toString(16).padStart(6,"0"),ce=0,q=new Map,de=r=>G(K(q,r,++ce));new t(n).graphData(le).onNodeClick(({ref:r,element:f,watcher:u})=>{console.log(...r?[r._value,r]:[f??u]),U(window,{$:r??f??u})}).nodeAutoColorBy("class").nodeCanvasObjectMode(({ref:r,element:f})=>r?"after":f&&"replace").nodeCanvasObject(({ref:r,element:f,x:u,y:N,val:pe},w)=>{r?.name&&u&&N&&(w.font="10px Arial",w.fillText(r.name,u+10,N)),f&&u&&N&&(w.beginPath(),w.arc(u,N,Math.sqrt(Number(pe)+1),0,2*Math.PI,!1),w.fillStyle="white",w.fill(),w.lineWidth=2,w.strokeStyle=de(f.tagName),w.stroke())}).linkLineDash(({target:r})=>typeof r=="object"&&r.element?[4,2]:null).linkDirectionalParticles(1);let _={refNodes:l,elementNodes:v,refLinks:d,watcherLinks:T,elementLinks:H};U(window.smork,_),console.log(_)}Object.assign(window,{smork:{devTools:at,allRefs:ne,allElements:j,refToElementLinks:W}});var je=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function ve(t){function e(o,i){let[a,l]=Array.isArray(o)?[void 0,o]:[o,i];return n(a,l)}return e;function n(o,i){let a=document.createElement(t);return D&&j.add(a),o&&Ne(o,(l,d)=>{typeof l=="function"?a[d]=l:E(l,p=>{g(ke(p)),Oe(p).watch(g),D&&p instanceof b&&K(W,p,new Set).add(a);function g(T){typeof T=="boolean"?T?a.setAttribute(d,""):a.removeAttribute(d):a.setAttribute(d,String(T))}})}),i&&i.forEach(l=>{let d=void 0,p=g=>{let T=typeof g=="string"?document.createTextNode(g):g instanceof HTMLElement?g:document.createComment("");d?d.replaceWith(T):a.appendChild(T),d=T};l instanceof b?l.watchImmediate(p):p(l),D&&l instanceof b&&K(W,l,new Set).add(a)}),a}}var{a:We,abbr:sn,address:ln,area:cn,article:dn,aside:pn,audio:He,b:un,base:fn,bdi:mn,bdo:yn,blockquote:Tn,body:gn,br:hn,button:S,canvas:bn,caption:xn,cite:wn,code:kn,col:vn,colgroup:Rn,data:Cn,datalist:Ln,dd:Sn,del:An,details:Nn,dfn:In,dialog:En,div:m,dl:Un,dt:Kn,em:Dn,embed:Pn,fieldset:_n,figcaption:Fn,figure:Bn,footer:$n,form:Mn,h1:On,h2:jn,h3:ze,h4:Wn,h5:Hn,h6:zn,head:Gn,header:qn,hgroup:Vn,hr:Jn,html:Yn,i:Xn,iframe:Qn,img:Ge,input:Zn,ins:eo,kbd:to,label:st,legend:no,li:oo,link:ro,main:io,map:ao,mark:so,menu:lo,meta:co,meter:po,nav:uo,noscript:fo,object:mo,ol:yo,optgroup:To,option:go,output:ho,p:qe,picture:bo,pre:xo,progress:wo,q:ko,rp:vo,rt:Ro,ruby:Co,s:Lo,samp:So,script:lt,search:Ao,section:No,select:Io,slot:Eo,small:Uo,source:Ko,span:Do,strong:Po,style:Ve,sub:_o,summary:Fo,sup:Bo,table:$o,tbody:Mo,td:Oo,template:jo,textarea:Wo,tfoot:Ho,th:zo,thead:Go,time:qo,title:Vo,tr:Jo,track:Yo,u:Xo,ul:Qo,var:Zo,video:er,wbr:tr}=je.reduce((t,e)=>(t[e]=ve(e),t),{});function re(t,e){return ve("input")({...e,type:"checkbox",checked:t,onchange:()=>t.set(!t.value)})}function Je(t,e){return ve("input")({...e,type:"text",value:t,onkeyup:({key:n,target:o})=>{n==="Enter"&&o instanceof HTMLInputElement&&t.set(o.value)}})}function ie(t,e){e.id||=A("smork-input-");let n=[st({for:e.id},[t]),e];return e.type==="checkbox"&&n.reverse(),n}async function oe(t,e){return window[t]?window[t]:new Promise(n=>{document.head.appendChild(lt({src:e,onload:()=>n(window[t])}))})}function P(t,e,n=void 0){return t.map(o=>o?ge(e,o):ge(n))}function Re({id:t,image_url:e,name:n,tags:o}){return m({class:"relative"},[We({href:`https://suno.com/song/${t}`,target:"_blank"},[Ge({src:e,style:"opacity: 0.5; width: 200px"}),m({class:"absolute topleft",style:"width: 190px; padding: 5px"},[m([n||"[Untitled]"]),m({class:"smol"},[o||"(no style)"])])])])}var Ye='.colony { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;}.colony button {background-color: #444;color: #eee}.colony #sidebar {position: fixed;padding: 10px;top: 0;left: 0;bottom: 0;width: 200px;background-color: #333;color: #eee;display: flex;flex-direction: column;justify-content: space-between;}.colony .f-row {display: flex;flex-direction: row;}.colony .f-col {display: flex;flex-direction: column;}.colony .smol {font-size: 0.8em;color: #aaa;}.colony .relative {position: relative;}.colony .absolute {position: absolute;}.colony .topleft {top: 0;left: 0;}.colony .p-1 {padding: 1rem;};.colony .p-2 {padding: 2rem;}.colony .w-100 {width: 100%;}.colony .h-100 {height: 100%;}.colony .j-between {justify-content: space-between;}.colony .settings > * {margin-top: 5px;}';async function Ce(t,e,{mode:n=void 0}){let o=Y(e);let i=n?.toLowerCase()==="3d",a=h(!1).named("hideUI"),l=a.map(s=>!s).named("showUI"),d=h(!0).named("useNextLinks"),p=h(!0).named("useDescendantLinks"),g=h("").named("filterString"),T=h(!1).named("showNextLinks"),x=h().named("audioElement"),v=h().named("selectedClip");v.watch(()=>setTimeout(()=>{x.value?.play()},0));let L=new Map;function R(s){return L.get(s)??Fe(o?.nodes.find(c=>c.id===s)??k(`Node with ID ${s} not found.`),c=>L.set(s,c))}let H=await oe("ForceGraph",`https://unpkg.com/${i?"3d-":""}force-graph`);window.document.head.appendChild(Ve([Ye]));let z=m(),C=new H(z).graphData(o).backgroundColor("#001").linkAutoColorBy("kind").nodeAutoColorBy("rootId").linkLabel("kind").linkDirectionalParticles(1).nodeLabel(s=>m([Re(s),m({class:"smol"},["Click to play, right-click to open in Suno"])]).outerHTML).onNodeClick(we(v)).onNodeRightClick(({id:s})=>{window.open(`https://suno.com/song/${s}`)});i?C.linkOpacity(s=>s.isMain?1:.2):C.linkLineDash(s=>s.isMain?null:[1,2]),Object.assign(window,{graph:C});async function le(){new FinalizationRegistry(()=>console.log("Previous graph destroyed, container removed from memory")).register(C,""),C._destructor(),w.remove(),await Ce(this,e,{mode:n})}T.watchImmediate(s=>{C.linkVisibility(c=>!{descendant:!0,next:!s}[c.kind])});function G(s){return typeof s=="string"?s:s.id}function ce(s,c){return G(s)===G(c)}function q(s){return c=>ce(s,c)}let de=h(Date.now).named("graphLastUpdated"),_=g.map(s=>{let{nodes:c}=o;return s?(s=s.toLowerCase(),c.filter(y=>`${y.id} ${y.name} ${y.tags} ${y.created_at}`.toLowerCase().includes(s))):c}).named("matchingNodes");_.watchImmediate(s=>C.nodeVal(c=>s.some(y=>y.id===c.id)?3:c.val));let r=h({filter:g,nodes:_}).map(({filter:s,nodes:c})=>s?[...c,...o.nodes?.filter(y=>!c.includes(y)&&c.some(I=>I.rootId===y.rootId))??[]]:c).named("nodes"),f=r.map(s=>s?o.links.filter(c=>s.some(q(c.source))&&s.some(q(c.target))):[]).named("linksBetweenFilteredNodes"),u=h({nodes:r,useNextLinks:d}).map(({nodes:s,useNextLinks:c})=>!s||!c?[]:(B(s),s.filter(y=>y.rootId===y.id).slice(1).map((y,I)=>({source:s[I].id,target:y.id,kind:"next",color:"#006",isMain:!1})))).named("nextLinks"),N=h({nodes:r,useDescendantLinks:p}).map(({nodes:s,useDescendantLinks:c})=>!s||!c?[]:Ue(s.map(y=>{let I=R(y.rootId??k(`Node ${y.id} has no root ID.`));return I!==y?{source:I.id,target:y.id,kind:"descendant",isMain:!1}:null}))).named("descendantLinks"),pe=h({linksBetweenFilteredNodes:f,nextLinks:u,descendantLinks:N}).map(({linksBetweenFilteredNodes:s,nextLinks:c,descendantLinks:y})=>[...s,...c,...y]).named("links");h({nodes:r,links:pe}).named("graphData").watchImmediate(s=>{C.graphData(s),de.update()}),setTimeout(()=>{d.set(!1),p.set(!1)},2e3);let w=document.body.appendChild(m({class:"colony",style:"position: fixed; top: 0px; left: 0px; z-index: 100;"},[P(l,m({style:"flex-direction: column; height: 100vh; width: 100vh; background-color: #000;"},[z,m({id:"sidebar"},[m({class:"settings f-col"},[S({style:"margin-bottom: 5px;",onclick:()=>a.set(!0)},["Close Colony"]),ze(["Settings"]),m(ie("Attract based on time",re(d))),P(d,m(ie("Show time-based links",re(T)))),m(ie("Attract to root clip",re(p))),m([Je(g,{placeholder:"Filter by name, style or ID"}),qe({class:"smol"},["Enter to apply. (Filter will include both matching nodes and any nodes belonging to the same root clip.)"])]),S({onclick:le},["Redraw"]),S({onclick:()=>t.renderToFile(n)},["Download"])]),P(v,s=>m({class:"w-100"},[Re(s),x.value=He({src:s.audio_url,controls:!0,class:"w-100"})]))])]),S({style:"position: fixed; top: 0px; left: 0px; padding: 5px; z-index: 100;",onclick:()=>a.set(!1)},["Reopen Colony"]))]))}var ct="https://studio-api.prod.suno.com/api/";function Xe(t,e){return async(...n)=>{let o=t(...n),i=await fetch(ct+o,{headers:{authorization:`Bearer ${await window.Clerk.session.getToken()}`}});if(i.status===404&&e){console.warn(`Could not find resource at ${o}, returning undefined`);return}return await i.json()}}var Le={getClips:Xe(t=>"feed/v2?is_liked=true&page="+t),getClip:Xe(t=>"clip/"+t,!0)};var dt=["next","descendant"];var Se={rawClips:fe(),lastProcessedPage:-1,allPagesProcessed:!1,links:fe(),allLinksBuilt:!1},se=class{constructor(e=Se){this.state=e;this.loadState()}reset(){this.state=Se,console.log("Colony reset. Run build() to start building it again.")}storage=new Q("colony",Se);stateLoaded=new X;async loadState(e=!1){if(e){let n=await _e();if(!n){console.log("No file selected, aborting.");return}this.state=JSON.parse(n)}else this.state=await this.storage.load();this.stateLoaded.resolve()}async saveState(e=!1){if(e){let n=JSON.stringify(this.state),o=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download="suno_colony.json",a.click(),URL.revokeObjectURL(i)}else await this.storage.save(this.state)}async build(){try{this.state.allPagesProcessed||await this.fetchClips(),this.state.allLinksBuilt||await this.buildLinks()}finally{await this.saveState()}}async fetchClips(){for(console.log("Fetching liked clips...");;){await me(1e3);let{clips:e}=await Le.getClips(this.state.lastProcessedPage+1);if(!e.length){this.state.allPagesProcessed=!0;break}this.state.rawClips.push(...e),this.state.lastProcessedPage++,console.log(`Processed page ${this.state.lastProcessedPage}; total clips: ${this.state.rawClips.length}`)}}rawClipsById={};async loadClip(e){await me(1e3);console.log(`Clip ${e} not found in cache, loading...`);let n=await Le.getClip(e)??ut(e);return this.state.rawClips.push(n),n}getClipByIdSync(e){return this.rawClipsById[e]??=this.state.rawClips.find(n=>pt(e)?n.audio_url.includes(e):n.id===e)}async getClipById(e){return e.startsWith("m_")&&(e=e.slice(2)),this.getClipByIdSync(e)??await this.loadClip(e)}async buildLinks(){console.log("Building links...");for(let e=0;e<this.state.rawClips.length;e++){let n=this.state.rawClips[e];e%100===0&&console.log(`Processed ${e} clips out of ${this.state.rawClips.length}`);let{metadata:o}=n,[i,a]="history"in o?E(o.history[0],l=>typeof l=="string"?[l,"extend"]:l.infill?[l.id,"inpaint"]:[l.id,"extend"]):"concat_history"in o?[o.concat_history[1].id,"apply"]:"cover_clip_id"in o?[o.cover_clip_id,"cover"]:"upsample_clip_id"in o?[o.upsample_clip_id,"remaster"]:"type"in o&&o.type==="edit_crop"?await $e(n,this.state.rawClips).then(l=>l?[l,"crop"]:[void 0,void 0]):[void 0,void 0];i&&this.state.links.push([(await this.getClipById(i)).id,n.id,a])}this.state.allLinksBuilt=!0,console.log(`Built ${this.state.links.length} links.`),console.log("Colony built. Run `await vovas.colony.render()` to view it!")}_linkedClips;get linkedClips(){return this._linkedClips??=this.getLinkedClips()}getLinkedClips(){let e=this.state.links.reduce((o,[i,a,l])=>{let d=V(o,{id:i})??k(`Could not find parent for link ${i} -> ${a}.`),p=V(o,{id:a})??k(`Could not find child for link ${i} -> ${a}.`);if(p.parent)throw new Error(`Child ${a} already has a parent: ${p.parent.clip.id}`);return p.parent={kind:l,clip:d},(d.children??=[]).push({kind:l,clip:p}),o},Y(this.state.rawClips));for(let o of e.filter(({parent:i})=>!i))n(o,o);return e;function n(o,i){Object.assign(o,{root:i});for(let{clip:a}of o.children??[])n(a,i)}}_rootClips;get rootClips(){return this._rootClips??=this.getRootClips()}getRootClips(){let e=this.linkedClips.filter(({parent:n})=>!n);return B(e)}get sortedClips(){let e=[],{rootClips:n}=this;for(let i of n)o(i);return e.reverse();function o(i){e.push(i);let{children:a}=i;if(a)for(let{clip:l}of B(a,({clip:d})=>d.created_at))o(l)}}get syntheticLinks(){let e=[];return e}getTotalDescendants(e){let n=V(this.linkedClips,{id:e})??k(`Clip ${e} not found.`);return n.totalDescendants??=1+(n.children?.reduce((o,{clip:{id:i}})=>o+this.getTotalDescendants(i),0)??0)}_graphData=void 0;getGraphData(){let e=this.sortedClips.map(({id:i,title:a,metadata:{tags:l},created_at:d,children:p,audio_url:g,image_url:T,root:x})=>({id:i,name:a||l||d||i,created_at:d,audio_url:g,image_url:T,tags:l,rootId:x?.id,val:i===x?.id&&p?.length?2:p?.length?1:.5})),n=([i,a,l])=>({source:i,target:a,kind:l,color:l==="next"?"#006":void 0,isMain:!dt.includes(l)&&this.getTotalDescendants(a)>1});return{nodes:e,links:[...this.syntheticLinks,...this.state.links].map(n)}}get graphData(){return this._graphData??=this.getGraphData()}getHtml(e){return console.log("Rendering your colony, give it a few seconds..."),`<script>(vovas = {${window.vovas.main.toString()}}).main();vovas.colony.render(...${JSON.stringify([e,this.graphData])})<\/script>`}async render(e,n){console.log("Rendering your colony, give it a few seconds..."),this._graphData??=n,await Ce(this,this.graphData,{mode:e})}renderToFile(...e){let n=this.getHtml(...e),o=new Blob([n],{type:"text/html"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download="suno_colony.html",a.click(),URL.revokeObjectURL(i)}},ae=new se;ae.stateLoaded.promise.then(async()=>{console.log("Welcome to Vova\u2019s Suno Colony! This is a nifty tool to visualize your liked clips and the relationships between them, such as extensions, inpaints, covers, etc., in a graph format. It takes a bit of time and hacks to build, but hopefully it\u2019ll be worth it!");let{state:{allPagesProcessed:t,allLinksBuilt:e}}=ae;!t||!e?console.log("Run `await vovas.colony.build()` to start or continue building your colony!"):(console.log("Your colony is built, rendering!"),await ae.render())});function pt(t){return t.match(/_\d+$/)}function ut(t){return console.warn(`Clip ${t} not found, creating a missing clip.`),{isMissing:!0,id:t,title:"*Clip not found*",created_at:null,audio_url:`https://cdn1.suno.ai/${t}.mp3`,image_url:"",metadata:{duration:0,tags:""}}}U(window.vovas,{Colony:se,colony:ae,debug:ye});ye();})();
}}).main();
